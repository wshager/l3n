{"version":3,"sources":["../src/inode.js"],"names":["getType","vnode","create","get","has","next","previous","push","set","removeChild","cached","keys","values","finalize","count","first","last","entries","modify","toJS","stringify","cx","reservedNameKey","reservedChildrenKey","reservedArgsKey","reservedValueKeys","hashre","__vnode_context","node","cc","constructor","Array","Object","name","test","undefined","type","Number","Boolean","parent","depth","indexInParent","key","value","$key","VNode","nameOrValue","val","join","idx","_nextOrPrev","dir","kv","$value","k","v","child","splice","children","len","length","cache","i","map","lastItem","ref","x","reduce","acc","valueOf","_elemToString","e","attrFunc","z","str","c","prettifier","a"],"mappings":"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","file":"inode.js","sourcesContent":["import { VNode } from \"./vnode\";\r\n\r\nimport multimap from \"./multimap\";\r\n\r\nimport { serialize } from \"./doctype\";\r\n\r\nimport { isBranch } from \"./convert\";\r\n\r\n// import self!\r\nimport * as cx from \"./inode\";\r\n\r\n// helpers ---------------\r\n\r\n//import { q } from \"./qname\";\r\n\r\nconst reservedNameKey = \"$name\"; //[1,2,9,11,14]\r\nconst reservedChildrenKey = \"$children\"; //[1,9,11]\r\nconst reservedArgsKey = \"$args\"; //[14,15]\r\nconst reservedValueKeys = {\r\n\t2:\"$value\",\r\n\t4:\"$ref\",\r\n\t7:\"$pi\",\r\n\t8:\"$comment\",\r\n\t10:\"$doctype\"\r\n};\r\n\r\nconst hashre = /^#/;\r\n\r\nexport const __vnode_context = \"inode\";\r\n\r\nexport function getType(node) {\r\n\tif (node === null) return 12;\r\n\tvar cc = node.constructor;\r\n\tif (cc == Array) {\r\n\t\treturn 5;\r\n\t} else if (cc == Object) {\r\n\t\tif (reservedChildrenKey in node) {\r\n\t\t\tconst name = node[reservedNameKey];\r\n\t\t\treturn !hashre.test(name) ? 1 : name == \"#document\" ? 9 : 11;\r\n\t\t} else if (reservedArgsKey in node) {\r\n\t\t\treturn node[reservedNameKey] !== undefined ? 14 : 15;\r\n\t\t}\r\n\t\tfor(let type in reservedValueKeys) {\r\n\t\t\tif(reservedValueKeys[type] in node) return type;\r\n\t\t}\r\n\t\treturn 6;\r\n\t} else if (cc == Number || cc == Boolean) {\r\n\t\treturn 12;\r\n\t}\r\n\treturn 3;\r\n}\r\n\r\n// -----------------------\r\n\r\nexport function vnode(node, parent, depth, indexInParent, type) {\r\n\ttype = type || getType(node);\r\n\tlet name,key,value;\r\n\tif (isBranch(type)) {\r\n\t\tname = node[reservedNameKey];\r\n\t} else if (type == 2) {\r\n\t\tname = node[reservedNameKey];\r\n\t\tvalue = node[reservedValueKeys[2]];\r\n\t\t// this ensures pairs are iterated as their values (if no $key use attr node for construction)\r\n\t\tif (node.$key) {\r\n\t\t\tkey = node.$key;\r\n\t\t\tnode = value;\r\n\t\t\ttype = getType(node);\r\n\t\t}\r\n\t} else if(type == 3 || type == 12) {\r\n\t\tvalue = node;\r\n\t} else {\r\n\t\tvalue = node[reservedValueKeys[type]];\r\n\t}\r\n\treturn new VNode(cx, node, type, name, key, value, parent, depth, indexInParent);\r\n}\r\n\r\nexport function create(type, nameOrValue) {\r\n\tif(type == 5) return [];\r\n\tif(type == 6) return {};\r\n\tif(type == 3 || type == 12) return nameOrValue;\r\n\tconst node = {};\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tnode[reservedNameKey] = nameOrValue;\r\n\t\tnode[reservedChildrenKey] = [];\r\n\t} else if(type == 2) {\r\n\t\t// value will be inserted later\r\n\t\tnode[reservedNameKey] = nameOrValue;\r\n\t\tnode[reservedValueKeys[2]] = void 0;\r\n\t} else {\r\n\t\tconst val = type == 7 ? nameOrValue.join(\" \") : type == 10 ? serialize(...nameOrValue) : nameOrValue;\r\n\t\tnode[reservedValueKeys[type]] = val;\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function get(node,idx,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 6) {\r\n\t\treturn node[idx];\r\n\t}\r\n\tif(type == 14 || type == 15){\r\n\t\treturn node[reservedArgsKey][idx];\r\n\t}\r\n\treturn node[reservedChildrenKey][idx];\r\n}\r\n\r\nexport function has(node,idx,type) {\r\n\ttype = type || getType(node);\r\n\tif(type == 5 || type == 6) {\r\n\t\treturn idx in node;\r\n\t}\r\n\tif(type == 14 || type == 15){\r\n\t\treturn idx in node[reservedArgsKey];\r\n\t}\r\n\treturn idx in node[reservedChildrenKey];\r\n}\r\n\r\nvar _nextOrPrev = function _nextOrPrev(node, idx, type, dir) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\treturn node[reservedChildrenKey][idx + dir];\r\n\t}\r\n\tif (type == 14 || type == 15) {\r\n\t\treturn node[reservedArgsKey][idx + dir];\r\n\t}\r\n\tif (type == 5) return node[idx + dir];\r\n\tif (type == 6) {\r\n\t\tvar entries = Object.entries(node);\r\n\t\tvar kv = entries[idx + dir];\r\n\t\t// pass pair-wise\r\n\t\treturn { $key: kv[0], $value: kv[1] };\r\n\t}\r\n};\r\n\r\nexport function next(node, vnode, type) {\r\n\treturn _nextOrPrev(node, vnode.indexInParent - 1, type, 1);\r\n}\r\n\r\nexport function previous(node, vnode, type) {\r\n\treturn _nextOrPrev(node, vnode.indexInParent - 1, type, -1);\r\n}\r\n\r\nexport function push(node, [k,v], type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tnode[reservedChildrenKey].push(v);\r\n\t} else if (type == 14 || type == 15) {\r\n\t\tnode[reservedChildrenKey].push(v);\r\n\t} else if (type == 5) {\r\n\t\tnode.push(v);\r\n\t} else if (type == 6) {\r\n\t\tnode[k] = v;\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function set(node,key,val,type) {\r\n\ttype = type || getType(node);\r\n\tif(type == 1 || type == 6) {\r\n\t\tnode[key] = val;\r\n\t\treturn node;\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function removeChild(node, child, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9) {\r\n\t\tnode[reservedChildrenKey].splice(child.indexInParent, 1);\r\n\t} else if (type == 5) {\r\n\t\tnode.splice(child.indexInParent, 1);\r\n\t} else if (type == 6) {\r\n\t\tdelete node[child.key];\r\n\t} else if (type == 14 || type == 15) {\r\n\t\tnode[reservedArgsKey].splice(child.indexInParent, 1);\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function cached(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tlet children = node[reservedChildrenKey],\r\n\t\t\tlen = children.length,\r\n\t\t\tcache = multimap();\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tcache.push([children[i][reservedNameKey] || i + 1, children[i]]);\r\n\t\t}\r\n\t\treturn cache;\r\n\t}\r\n\tif (type == 5) {\r\n\t\treturn {\r\n\t\t\tkeys: function keys() {\r\n\t\t\t\treturn node.keys();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tif (type == 6) {\r\n\t\treturn {\r\n\t\t\tkeys: function keys() {\r\n\t\t\t\treturn Object.keys(node);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport function keys(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9) {\r\n\t\tlet children = node[reservedChildrenKey],\r\n\t\t\tlen = children.length,\r\n\t\t\tkeys = [];\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tkeys[i] = children[i][reservedNameKey] || i + 1;\r\n\t\t}\r\n\t\treturn keys;\r\n\t}\r\n\tif (type == 5) return node.keys();\r\n\tif (type == 6) return Object.keys(node);\r\n\treturn [];\r\n}\r\n\r\nexport function values(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) return node[reservedChildrenKey];\r\n\tif (type == 14 || type == 15) return node[reservedArgsKey];\r\n\tif (type == 2) return [[node[reservedNameKey], node[reservedValueKeys[2]]]];\r\n\tif (type == 6)\r\n\t\t// pair-wise\r\n\t\treturn Object.entries(node).map(function (kv) {\r\n\t\t\treturn { $key: kv[0], $value: kv[1] };\r\n\t\t});\r\n\tif(type == 3 || type == 12) return [node];\r\n\treturn [node[reservedValueKeys[type]]];\r\n}\r\n\r\nexport function finalize(node) {\r\n\treturn node;\r\n}\r\n\r\nexport function count(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\treturn node[reservedChildrenKey].length;\r\n\t} else if (type == 14 || type == 15) {\r\n\t\treturn node[reservedArgsKey].length;\r\n\t} else if (type == 5) {\r\n\t\treturn node.length;\r\n\t} else if (type == 6) {\r\n\t\treturn Object.keys(node).length;\r\n\t}\r\n\treturn 0;\r\n}\r\n\r\nexport function first(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\treturn node[reservedChildrenKey][0];\r\n\t} else if (type == 14 || type == 15) {\r\n\t\treturn node[reservedArgsKey][0];\r\n\t} else if (type == 5) {\r\n\t\treturn node[0];\r\n\t} else if (type == 6) {\r\n\t\tvar entries = Object.entries(node);\r\n\t\tvar kv = entries[0];\r\n\t\t// pass pair-wise\r\n\t\treturn { $key: kv[0], $value: kv[1] };\r\n\t}\r\n}\r\n\r\nexport function last(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) return node[reservedChildrenKey].lastItem;\r\n\tif (type == 5) return node.lastItem;\r\n\tif (type == 6) {\r\n\t\tvar entries = Object.entries(node);\r\n\t\tvar kv = entries.lastItem;\r\n\t\t// pass pair-wise\r\n\t\treturn { $key: kv[0], $value: kv[1] };\r\n\t}\r\n\tif (type == 14 || type == 15) return node[reservedArgsKey].lastItem;\r\n}\r\n\r\nexport function entries(node, type) {\r\n\ttype = type || getType(node);\r\n\tif(type == 5) return node.entries();\r\n\tif (type == 1 || type == 6 || type == 9 || type == 11) return Object.entries(node);\r\n\treturn [];\r\n}\r\n\r\nexport function modify(node, vnode, ref, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tif (vnode.type == 2) {\r\n\t\t\t// TODO conversion rules!\r\n\t\t\tnode[vnode.name] = vnode.node.$value + \"\";\r\n\t\t} else if (ref !== undefined) {\r\n\t\t\tnode[reservedChildrenKey].splice(ref.indexInParent, 0, vnode.node);\r\n\t\t} else {\r\n\t\t\tnode[reservedChildrenKey].push(vnode.node);\r\n\t\t}\r\n\t} else if (type == 14 || type == 15) {\r\n\t\tif (ref !== undefined) {\r\n\t\t\tnode[reservedArgsKey].splice(ref.indexInParent, 0, vnode.node);\r\n\t\t} else {\r\n\t\t\tnode[reservedArgsKey].push(vnode.node);\r\n\t\t}\r\n\t} else if (type == 2) {\r\n\t\tnode[reservedValueKeys[2]] = vnode.node;\r\n\t} else if (type == 5) {\r\n\t\tif (ref !== undefined) {\r\n\t\t\tnode.splice(ref.indexInParent, 0, vnode.node);\r\n\t\t} else {\r\n\t\t\tnode.push(vnode.node);\r\n\t\t}\r\n\t} else if (type == 6) {\r\n\t\tnode[vnode.name] = vnode.node[reservedValueKeys[2]];\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function toJS(node,type) {\r\n\ttype = type || getType(node);\r\n\tif(type == 5) {\r\n\t\treturn node.map(x => toJS(x));\r\n\t} else if(type == 6) {\r\n\t\treturn Object.entries(node).reduce((acc,[k,v]) => {\r\n\t\t\tacc[k] = toJS(v);\r\n\t\t\treturn acc;\r\n\t\t},{});\r\n\t} else {\r\n\t\treturn node.valueOf();\r\n\t}\r\n}\r\n\r\n\r\nfunction _elemToString(e) {\r\n\tconst attrFunc = (z, [k,v]) => {\r\n\t\tif(/^\\$/.test(k)) return z;\r\n\t\treturn z + (\" \" + k + \"=\\\"\" + v + \"\\\"\");\r\n\t};\r\n\tconst name = e[reservedNameKey];\r\n\tvar str = \"<\" + name;\r\n\tstr = Object.entries(e).reduce(attrFunc, str);\r\n\tconst children = e[reservedChildrenKey];\r\n\tif (children.length > 0) {\r\n\t\tstr += \">\";\r\n\t\tfor(let c of children){\r\n\t\t\tstr += stringify(c);\r\n\t\t}\r\n\t\tstr += \"</\" + name + \">\";\r\n\t} else {\r\n\t\tstr += \"/>\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\n// FIXME XML or HTML?\r\n// TODO ref type\r\nexport function stringify(node, type, prettifier) {\r\n\tvar str = \"\";\r\n\ttype = type || getType(node);\r\n\tif (type == 1) {\r\n\t\tstr += _elemToString(node);\r\n\t} else if(type == 9 || type == 11) {\r\n\t\tstr = node[reservedChildrenKey].map(c => stringify(c)).join(\"\");\r\n\t} else if (type == 2) {\r\n\t\tstr += \"<l3:a name=\\\"\" + node.$key + \"\\\">\" + stringify(node.$value) + \"</l3:a>\";\r\n\t} else if (type == 5) {\r\n\t\tconst val = node.map(c => stringify(c)).join(\"\");\r\n\t\tstr += \"<l3:l\" + (val ? \">\" + val + \"</l3:l>\" : \"/>\");\r\n\t} else if (type == 6) {\r\n\t\tconst val = Object.entries(node).reduce(function (a,c) {\r\n\t\t\treturn a + stringify({ $key: c[0], $value: stringify(c[1]) });\r\n\t\t},\"\");\r\n\t\tstr += \"<l3:m\" + (val ? \">\" + val + \"</l3:m>\" : \"/>\");\r\n\t} else if (type == 14 || type == 15) {\r\n\t\tconst val = node[reservedArgsKey].reduce((a,c) => a + stringify(c),\"\");\r\n\t\tif(type == 14) {\r\n\t\t\tstr += \"<l3:f name=\\\"\" + node[reservedNameKey] + \"\\\"\" + (val ? \">\" + val + \"</l3:f>\" : \"/>\");\r\n\t\t} else {\r\n\t\t\tstr += \"<l3:q\" + (val ? \">\" + val + \"</l3:q>\" : \"/>\");\r\n\t\t}\r\n\t} else {\r\n\t\tif (type == 7) {\r\n\t\t\tstr += \"<?\" + node[reservedValueKeys[7]] + \"?>\";\r\n\t\t} else if (type == 8) {\r\n\t\t\tstr += \"<!--\" + node[reservedValueKeys[8]] + \"-->\";\r\n\t\t} else if (type == 10) {\r\n\t\t\tstr += \"<!DOCTYPE \"+node[reservedValueKeys[10]]+\">\";\r\n\t\t} else {\r\n\t\t\tconst val = node === null ? \"null\" : node;\r\n\t\t\tstr += type == 12 ? \"<l3:x>\" + val + \"</l3:x>\" : val;\r\n\t\t}\r\n\t}\r\n\treturn prettifier ? prettifier(str) : str;\r\n}\r\n"]}