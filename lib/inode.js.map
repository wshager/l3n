{"version":3,"sources":["../src/inode.js"],"names":["reservedNameKey","reservedChildrenKey","reservedArgsKey","reservedValueKeys","hashre","__vnode_context","getType","node","cc","constructor","Array","Object","name","test","undefined","type","Number","Boolean","vnode","parent","depth","indexInParent","key","value","$key","VNode","cx","create","nameOrValue","val","join","get","idx","has","_nextOrPrev","dir","entries","kv","$value","next","previous","push","k","v","set","removeChild","child","splice","cached","children","len","length","cache","i","keys","values","map","finalize","count","first","last","lastItem","dollarRE","filter","modify","ref","toJS","x","reduce","acc","valueOf","_elemToString","e","attrFunc","z","str","c","stringify","prettifier","a"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;AAGA;;;;;;AADA;AAGA;AAEA;AAEA,MAAMA,kBAAkB,OAAxB,C,CAAiC;;AACjC,MAAMC,sBAAsB,WAA5B,C,CAAyC;;AACzC,MAAMC,kBAAkB,OAAxB,C,CAAiC;;AACjC,MAAMC,oBAAoB;AACzB,KAAE,QADuB;AAEzB,KAAE,MAFuB;AAGzB,KAAE,KAHuB;AAIzB,KAAE,UAJuB;AAKzB,MAAG;AALsB,CAA1B;AAQA,MAAMC,SAAS,IAAf;AAEO,MAAMC,kBAAkB,OAAxB;;;AAEA,SAASC,OAAT,CAAiBC,IAAjB,EAAuB;AAC7B,MAAIA,SAAS,IAAb,EAAmB,OAAO,EAAP;AACnB,MAAIC,KAAKD,KAAKE,WAAd;;AACA,MAAID,MAAME,KAAV,EAAiB;AAChB,WAAO,CAAP;AACA,GAFD,MAEO,IAAIF,MAAMG,MAAV,EAAkB;AACxB,QAAIV,uBAAuBM,IAA3B,EAAiC;AAChC,YAAMK,OAAOL,KAAKP,eAAL,CAAb;AACA,aAAO,CAACI,OAAOS,IAAP,CAAYD,IAAZ,CAAD,GAAqB,CAArB,GAAyBA,QAAQ,WAAR,GAAsB,CAAtB,GAA0B,EAA1D;AACA,KAHD,MAGO,IAAIV,mBAAmBK,IAAvB,EAA6B;AACnC,aAAOA,KAAKP,eAAL,MAA0Bc,SAA1B,GAAsC,EAAtC,GAA2C,EAAlD;AACA;;AACD,SAAI,IAAIC,IAAR,IAAgBZ,iBAAhB,EAAmC;AAClC,UAAGA,kBAAkBY,IAAlB,KAA2BR,IAA9B,EAAoC,OAAOQ,IAAP;AACpC;;AACD,WAAO,CAAP;AACA,GAXM,MAWA,IAAIP,MAAMQ,MAAN,IAAgBR,MAAMS,OAA1B,EAAmC;AACzC,WAAO,EAAP;AACA;;AACD,SAAO,CAAP;AACA,C,CAED;;;AAEO,SAASC,KAAT,CAAeX,IAAf,EAAqBY,MAArB,EAA6BC,KAA7B,EAAoCC,aAApC,EAAmDN,IAAnD,EAAyD;AAC/DA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;AACA,MAAIK,IAAJ,EAASU,GAAT,EAAaC,KAAb;;AACA,MAAI,oBAASR,IAAT,CAAJ,EAAoB;AACnBH,WAAOL,KAAKP,eAAL,CAAP;AACA,GAFD,MAEO,IAAIe,QAAQ,CAAZ,EAAe;AACrBH,WAAOL,KAAKP,eAAL,CAAP;AACAuB,YAAQhB,KAAKJ,kBAAkB,CAAlB,CAAL,CAAR,CAFqB,CAGrB;;AACA,QAAII,KAAKiB,IAAT,EAAe;AACdF,YAAMf,KAAKiB,IAAX;AACAjB,aAAOgB,KAAP;AACAR,aAAOT,QAAQC,IAAR,CAAP;AACA;AACD,GATM,MASA,IAAGQ,QAAQ,CAAR,IAAaA,QAAQ,EAAxB,EAA4B;AAClCQ,YAAQhB,IAAR;AACA,GAFM,MAEA;AACNgB,YAAQhB,KAAKJ,kBAAkBY,IAAlB,CAAL,CAAR;AACA;;AACD,SAAO,IAAIU,YAAJ,CAAUC,EAAV,EAAcnB,IAAd,EAAoBQ,IAApB,EAA0BH,IAA1B,EAAgCU,GAAhC,EAAqCC,KAArC,EAA4CJ,MAA5C,EAAoDC,KAApD,EAA2DC,aAA3D,CAAP;AACA;;AAEM,SAASM,MAAT,CAAgBZ,IAAhB,EAAsBa,WAAtB,EAAmC;AACzC,MAAGb,QAAQ,CAAX,EAAc,OAAO,EAAP;AACd,MAAGA,QAAQ,CAAX,EAAc,OAAO,EAAP;AACd,MAAGA,QAAQ,CAAR,IAAaA,QAAQ,EAAxB,EAA4B,OAAOa,WAAP;AAC5B,QAAMrB,OAAO,EAAb;AACA,MAAG,mBAAQQ,IAAR,CAAH,EAAkBR,KAAKP,eAAL,IAAwB4B,WAAxB;;AAClB,MAAIb,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C;AACzCR,SAAKN,mBAAL,IAA4B,EAA5B;AACA,GAFD,MAEO,IAAGc,QAAQ,EAAR,IAAcA,QAAQ,EAAzB,EAA6B;AACnCR,SAAKL,eAAL,IAAwB,EAAxB;AACA,GAFM,MAEA,IAAGa,QAAQ,CAAX,EAAc;AACpB;AACAR,SAAKJ,kBAAkB,CAAlB,CAAL,IAA6B,KAAK,CAAlC;AACA,GAHM,MAGA;AACN,UAAM0B,MAAMd,QAAQ,CAAR,GAAYa,YAAYE,IAAZ,CAAiB,GAAjB,CAAZ,GAAoCf,QAAQ,EAAR,GAAa,wBAAU,GAAGa,WAAb,CAAb,GAAyCA,WAAzF;AACArB,SAAKJ,kBAAkBY,IAAlB,CAAL,IAAgCc,GAAhC;AACA;;AACD,SAAOtB,IAAP;AACA;;AAEM,SAASwB,GAAT,CAAaxB,IAAb,EAAkByB,GAAlB,EAAsBjB,IAAtB,EAA2B;AACjCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAGQ,QAAQ,CAAX,EAAc;AACb,WAAOR,KAAKyB,GAAL,CAAP;AACA;;AACD,MAAGjB,QAAQ,EAAR,IAAcA,QAAQ,EAAzB,EAA4B;AAC3B,WAAOR,KAAKL,eAAL,EAAsB8B,GAAtB,CAAP;AACA;;AACD,SAAOzB,KAAKN,mBAAL,EAA0B+B,GAA1B,CAAP;AACA;;AAEM,SAASC,GAAT,CAAa1B,IAAb,EAAkByB,GAAlB,EAAsBjB,IAAtB,EAA4B;AAClCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAGQ,QAAQ,CAAR,IAAaA,QAAQ,CAAxB,EAA2B;AAC1B,WAAOiB,OAAOzB,IAAd;AACA;;AACD,MAAGQ,QAAQ,EAAR,IAAcA,QAAQ,EAAzB,EAA4B;AAC3B,WAAOiB,OAAOzB,KAAKL,eAAL,CAAd;AACA;;AACD,SAAO8B,OAAOzB,KAAKN,mBAAL,CAAd;AACA;;AAED,IAAIiC,cAAc,SAASA,WAAT,CAAqB3B,IAArB,EAA2ByB,GAA3B,EAAgCjB,IAAhC,EAAsCoB,GAAtC,EAA2C;AAC5DpB,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C;AACzC,WAAOR,KAAKN,mBAAL,EAA0B+B,MAAMG,GAAhC,CAAP;AACA;;AACD,MAAIpB,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B;AAC7B,WAAOR,KAAKL,eAAL,EAAsB8B,MAAMG,GAA5B,CAAP;AACA;;AACD,MAAIpB,QAAQ,CAAZ,EAAe,OAAOR,KAAKyB,MAAMG,GAAX,CAAP;;AACf,MAAIpB,QAAQ,CAAZ,EAAe;AACd,QAAIqB,UAAUzB,OAAOyB,OAAP,CAAe7B,IAAf,CAAd;AACA,QAAI8B,KAAKD,QAAQJ,MAAMG,GAAd,CAAT,CAFc,CAGd;;AACA,WAAO;AAAEX,YAAMa,GAAG,CAAH,CAAR;AAAeC,cAAQD,GAAG,CAAH;AAAvB,KAAP;AACA;AACD,CAfD;;AAiBO,SAASE,IAAT,CAAchC,IAAd,EAAoBW,KAApB,EAA2BH,IAA3B,EAAiC;AACvC,SAAOmB,YAAY3B,IAAZ,EAAkBW,MAAMG,aAAN,GAAsB,CAAxC,EAA2CN,IAA3C,EAAiD,CAAjD,CAAP;AACA;;AAEM,SAASyB,QAAT,CAAkBjC,IAAlB,EAAwBW,KAAxB,EAA+BH,IAA/B,EAAqC;AAC3C,SAAOmB,YAAY3B,IAAZ,EAAkBW,MAAMG,aAAN,GAAsB,CAAxC,EAA2CN,IAA3C,EAAiD,CAAC,CAAlD,CAAP;AACA;;AAEM,SAAS0B,IAAT,CAAclC,IAAd,EAAoB,CAACmC,CAAD,EAAGC,CAAH,CAApB,EAA2B5B,IAA3B,EAAiC;AACvCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C;AACzCR,SAAKN,mBAAL,EAA0BwC,IAA1B,CAA+BE,CAA/B;AACA,GAFD,MAEO,IAAI5B,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B;AACpCR,SAAKN,mBAAL,EAA0BwC,IAA1B,CAA+BE,CAA/B;AACA,GAFM,MAEA,IAAI5B,QAAQ,CAAZ,EAAe;AACrBR,SAAKkC,IAAL,CAAUE,CAAV;AACA,GAFM,MAEA,IAAI5B,QAAQ,CAAZ,EAAe;AACrBR,SAAKmC,CAAL,IAAUC,CAAV;AACA;;AACD,SAAOpC,IAAP;AACA;;AAEM,SAASqC,GAAT,CAAarC,IAAb,EAAkBe,GAAlB,EAAsBO,GAAtB,EAA0Bd,IAA1B,EAAgC;AACtCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAGQ,QAAQ,CAAR,IAAaA,QAAQ,CAAxB,EAA2B;AAC1BR,SAAKe,GAAL,IAAYO,GAAZ;AACA,WAAOtB,IAAP;AACA;;AACD,SAAOA,IAAP;AACA;;AAEM,SAASsC,WAAT,CAAqBtC,IAArB,EAA2BuC,KAA3B,EAAkC/B,IAAlC,EAAwC;AAC9CA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C;AACzCR,SAAKN,mBAAL,EAA0B8C,MAA1B,CAAiCD,MAAMzB,aAAvC,EAAsD,CAAtD;AACA,GAFD,MAEO,IAAIN,QAAQ,CAAZ,EAAe;AACrBR,SAAKwC,MAAL,CAAYD,MAAMzB,aAAlB,EAAiC,CAAjC;AACA,GAFM,MAEA,IAAIN,QAAQ,CAAZ,EAAe;AACrB,WAAOR,KAAKuC,MAAMxB,GAAX,CAAP;AACA,GAFM,MAEA,IAAIP,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B;AACpCR,SAAKL,eAAL,EAAsB6C,MAAtB,CAA6BD,MAAMzB,aAAnC,EAAkD,CAAlD;AACA;;AACD,SAAOd,IAAP;AACA;;AAEM,SAASyC,MAAT,CAAgBzC,IAAhB,EAAsBQ,IAAtB,EAA4B;AAClCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C;AACzC,QAAIkC,WAAW1C,KAAKN,mBAAL,CAAf;AAAA,QACCiD,MAAMD,SAASE,MADhB;AAAA,QAECC,QAAQ,wBAFT;;AAGA,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIH,GAApB,EAAyBG,GAAzB,EAA8B;AAC7BD,YAAMX,IAAN,CAAW,CAACQ,SAASI,CAAT,EAAYrD,eAAZ,KAAgCqD,IAAI,CAArC,EAAwCJ,SAASI,CAAT,CAAxC,CAAX;AACA;;AACD,WAAOD,KAAP;AACA;;AACD,MAAIrC,QAAQ,CAAZ,EAAe;AACd,WAAO;AACNuC,YAAM,SAASA,IAAT,GAAgB;AACrB,eAAO/C,KAAK+C,IAAL,EAAP;AACA;AAHK,KAAP;AAKA;;AACD,MAAIvC,QAAQ,CAAZ,EAAe;AACd,WAAO;AACNuC,YAAM,SAASA,IAAT,GAAgB;AACrB,eAAO3C,OAAO2C,IAAP,CAAY/C,IAAZ,CAAP;AACA;AAHK,KAAP;AAKA;AACD;;AAEM,SAAS+C,IAAT,CAAc/C,IAAd,EAAoBQ,IAApB,EAA0B;AAChCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAAzB,EAA4B;AAC3B,QAAIkC,WAAW1C,KAAKN,mBAAL,CAAf;AAAA,QACCiD,MAAMD,SAASE,MADhB;AAAA,QAECG,OAAO,EAFR;;AAGA,SAAK,IAAID,IAAI,CAAb,EAAgBA,IAAIH,GAApB,EAAyBG,GAAzB,EAA8B;AAC7BC,WAAKD,CAAL,IAAUJ,SAASI,CAAT,EAAYrD,eAAZ,KAAgCqD,IAAI,CAA9C;AACA;;AACD,WAAOC,IAAP;AACA;;AACD,MAAIvC,QAAQ,CAAZ,EAAe,OAAOR,KAAK+C,IAAL,EAAP;AACf,MAAIvC,QAAQ,CAAZ,EAAe,OAAOJ,OAAO2C,IAAP,CAAY/C,IAAZ,CAAP;AACf,SAAO,EAAP;AACA;;AAEM,SAASgD,MAAT,CAAgBhD,IAAhB,EAAsBQ,IAAtB,EAA4B;AAClCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C,OAAOR,KAAKN,mBAAL,CAAP;AAC1C,MAAIc,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B,OAAOR,KAAKL,eAAL,CAAP;AAC9B,MAAIa,QAAQ,CAAZ,EAAe,OAAO,CAAC,CAACR,KAAKP,eAAL,CAAD,EAAwBO,KAAKJ,kBAAkB,CAAlB,CAAL,CAAxB,CAAD,CAAP;AACf,MAAIY,QAAQ,CAAZ,EACC;AACA,WAAOJ,OAAOyB,OAAP,CAAe7B,IAAf,EAAqBiD,GAArB,CAAyB,UAAUnB,EAAV,EAAc;AAC7C,aAAO;AAAEb,cAAMa,GAAG,CAAH,CAAR;AAAeC,gBAAQD,GAAG,CAAH;AAAvB,OAAP;AACA,KAFM,CAAP;AAGD,MAAGtB,QAAQ,CAAR,IAAaA,QAAQ,EAAxB,EAA4B,OAAO,CAACR,IAAD,CAAP;AAC5B,SAAO,CAACA,KAAKJ,kBAAkBY,IAAlB,CAAL,CAAD,CAAP;AACA;;AAEM,SAAS0C,QAAT,CAAkBlD,IAAlB,EAAwB;AAC9B,SAAOA,IAAP;AACA;;AAEM,SAASmD,KAAT,CAAenD,IAAf,EAAqBQ,IAArB,EAA2B;AACjCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C;AACzC,WAAOR,KAAKN,mBAAL,EAA0BkD,MAAjC;AACA,GAFD,MAEO,IAAIpC,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B;AACpC,WAAOR,KAAKL,eAAL,EAAsBiD,MAA7B;AACA,GAFM,MAEA,IAAIpC,QAAQ,CAAZ,EAAe;AACrB,WAAOR,KAAK4C,MAAZ;AACA,GAFM,MAEA,IAAIpC,QAAQ,CAAZ,EAAe;AACrB,WAAOJ,OAAO2C,IAAP,CAAY/C,IAAZ,EAAkB4C,MAAzB;AACA;;AACD,SAAO,CAAP;AACA;;AAEM,SAASQ,KAAT,CAAepD,IAAf,EAAqBQ,IAArB,EAA2B;AACjCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C;AACzC,WAAOR,KAAKN,mBAAL,EAA0B,CAA1B,CAAP;AACA,GAFD,MAEO,IAAIc,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B;AACpC,WAAOR,KAAKL,eAAL,EAAsB,CAAtB,CAAP;AACA,GAFM,MAEA,IAAIa,QAAQ,CAAZ,EAAe;AACrB,WAAOR,KAAK,CAAL,CAAP;AACA,GAFM,MAEA,IAAIQ,QAAQ,CAAZ,EAAe;AACrB,QAAIqB,UAAUzB,OAAOyB,OAAP,CAAe7B,IAAf,CAAd;AACA,QAAI8B,KAAKD,QAAQ,CAAR,CAAT,CAFqB,CAGrB;;AACA,WAAO;AAAEZ,YAAMa,GAAG,CAAH,CAAR;AAAeC,cAAQD,GAAG,CAAH;AAAvB,KAAP;AACA;AACD;;AAEM,SAASuB,IAAT,CAAcrD,IAAd,EAAoBQ,IAApB,EAA0B;AAChCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C,OAAOR,KAAKN,mBAAL,EAA0B4D,QAAjC;AAC1C,MAAI9C,QAAQ,CAAZ,EAAe,OAAOR,KAAKsD,QAAZ;;AACf,MAAI9C,QAAQ,CAAZ,EAAe;AACd,QAAIqB,UAAUzB,OAAOyB,OAAP,CAAe7B,IAAf,CAAd;AACA,QAAI8B,KAAKD,QAAQyB,QAAjB,CAFc,CAGd;;AACA,WAAO;AAAErC,YAAMa,GAAG,CAAH,CAAR;AAAeC,cAAQD,GAAG,CAAH;AAAvB,KAAP;AACA;;AACD,MAAItB,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B,OAAOR,KAAKL,eAAL,EAAsB2D,QAA7B;AAC9B;;AAED,MAAMC,WAAW,KAAjB;;AAEO,SAAS1B,OAAT,CAAiB7B,IAAjB,EAAuBQ,IAAvB,EAA6B;AACnCA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;AACA,MAAGQ,QAAQ,CAAX,EAAc,OAAOR,KAAK6B,OAAL,EAAP;AACd,MAAGrB,QAAQ,CAAX,EAAc,OAAOJ,OAAOyB,OAAP,CAAe7B,IAAf,CAAP;AACd,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,CAAlC,IAAuCA,QAAQ,EAAnD,EAAuD,OAAOJ,OAAOyB,OAAP,CAAe7B,IAAf,EAAqBwD,MAArB,CAA4B,CAAC,CAACrB,CAAD,CAAD,KAAS,CAACoB,SAASjD,IAAT,CAAc6B,CAAd,CAAtC,CAAP;AACvD,SAAO,EAAP;AACA;;AAEM,SAASsB,MAAT,CAAgBzD,IAAhB,EAAsBW,KAAtB,EAA6B+C,GAA7B,EAAkClD,IAAlC,EAAwC;AAC9CA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAR,IAAaA,QAAQ,CAArB,IAA0BA,QAAQ,EAAtC,EAA0C;AACzC,QAAIG,MAAMH,IAAN,IAAc,CAAlB,EAAqB;AACpB;AACAR,WAAKW,MAAMN,IAAX,IAAmBM,MAAMX,IAAN,CAAW+B,MAAX,GAAoB,EAAvC;AACA,KAHD,MAGO,IAAI2B,QAAQnD,SAAZ,EAAuB;AAC7BP,WAAKN,mBAAL,EAA0B8C,MAA1B,CAAiCkB,IAAI5C,aAArC,EAAoD,CAApD,EAAuDH,MAAMX,IAA7D;AACA,KAFM,MAEA;AACNA,WAAKN,mBAAL,EAA0BwC,IAA1B,CAA+BvB,MAAMX,IAArC;AACA;AACD,GATD,MASO,IAAIQ,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B;AACpC,QAAIkD,QAAQnD,SAAZ,EAAuB;AACtBP,WAAKL,eAAL,EAAsB6C,MAAtB,CAA6BkB,IAAI5C,aAAjC,EAAgD,CAAhD,EAAmDH,MAAMX,IAAzD;AACA,KAFD,MAEO;AACNA,WAAKL,eAAL,EAAsBuC,IAAtB,CAA2BvB,MAAMX,IAAjC;AACA;AACD,GANM,MAMA,IAAIQ,QAAQ,CAAZ,EAAe;AACrBR,SAAKJ,kBAAkB,CAAlB,CAAL,IAA6Be,MAAMX,IAAnC;AACA,GAFM,MAEA,IAAIQ,QAAQ,CAAZ,EAAe;AACrB,QAAIkD,QAAQnD,SAAZ,EAAuB;AACtBP,WAAKwC,MAAL,CAAYkB,IAAI5C,aAAhB,EAA+B,CAA/B,EAAkCH,MAAMX,IAAxC;AACA,KAFD,MAEO;AACNA,WAAKkC,IAAL,CAAUvB,MAAMX,IAAhB;AACA;AACD,GANM,MAMA,IAAIQ,QAAQ,CAAZ,EAAe;AACrBR,SAAKW,MAAMN,IAAX,IAAmBM,MAAMX,IAAN,CAAWJ,kBAAkB,CAAlB,CAAX,CAAnB;AACA;;AACD,SAAOI,IAAP;AACA;;AAEM,SAAS2D,IAAT,CAAc3D,IAAd,EAAmBQ,IAAnB,EAAyB;AAC/BA,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAGQ,QAAQ,CAAX,EAAc;AACb,WAAOR,KAAKiD,GAAL,CAASW,KAAKD,KAAKC,CAAL,CAAd,CAAP;AACA,GAFD,MAEO,IAAGpD,QAAQ,CAAX,EAAc;AACpB,WAAOJ,OAAOyB,OAAP,CAAe7B,IAAf,EAAqB6D,MAArB,CAA4B,CAACC,GAAD,EAAK,CAAC3B,CAAD,EAAGC,CAAH,CAAL,KAAe;AACjD0B,UAAI3B,CAAJ,IAASwB,KAAKvB,CAAL,CAAT;AACA,aAAO0B,GAAP;AACA,KAHM,EAGL,EAHK,CAAP;AAIA,GALM,MAKA;AACN,WAAO9D,KAAK+D,OAAL,EAAP;AACA;AACD;;AAGD,SAASC,aAAT,CAAuBC,CAAvB,EAA0B;AACzB,QAAMC,WAAW,CAACC,CAAD,EAAI,CAAChC,CAAD,EAAGC,CAAH,CAAJ,KAAc;AAC9B,QAAG,MAAM9B,IAAN,CAAW6B,CAAX,CAAH,EAAkB,OAAOgC,CAAP;AAClB,WAAOA,KAAK,MAAMhC,CAAN,GAAU,KAAV,GAAkBC,CAAlB,GAAsB,IAA3B,CAAP;AACA,GAHD;;AAIA,QAAM/B,OAAO4D,EAAExE,eAAF,CAAb;AACA,MAAI2E,MAAM,MAAM/D,IAAhB;AACA+D,QAAMhE,OAAOyB,OAAP,CAAeoC,CAAf,EAAkBJ,MAAlB,CAAyBK,QAAzB,EAAmCE,GAAnC,CAAN;AACA,QAAM1B,WAAWuB,EAAEvE,mBAAF,CAAjB;;AACA,MAAIgD,SAASE,MAAT,GAAkB,CAAtB,EAAyB;AACxBwB,WAAO,GAAP;;AACA,SAAI,IAAIC,CAAR,IAAa3B,QAAb,EAAsB;AACrB0B,aAAOE,UAAUD,CAAV,CAAP;AACA;;AACDD,WAAO,OAAO/D,IAAP,GAAc,GAArB;AACA,GAND,MAMO;AACN+D,WAAO,IAAP;AACA;;AACD,SAAOA,GAAP;AACA,C,CAED;AACA;;;AACO,SAASE,SAAT,CAAmBtE,IAAnB,EAAyBQ,IAAzB,EAA+B+D,UAA/B,EAA2C;AACjD,MAAIH,MAAM,EAAV;AACA5D,SAAOA,QAAQT,QAAQC,IAAR,CAAf;;AACA,MAAIQ,QAAQ,CAAZ,EAAe;AACd4D,WAAOJ,cAAchE,IAAd,CAAP;AACA,GAFD,MAEO,IAAGQ,QAAQ,CAAR,IAAaA,QAAQ,EAAxB,EAA4B;AAClC4D,UAAMpE,KAAKN,mBAAL,EAA0BuD,GAA1B,CAA8BoB,KAAKC,UAAUD,CAAV,CAAnC,EAAiD9C,IAAjD,CAAsD,EAAtD,CAAN;AACA,GAFM,MAEA,IAAIf,QAAQ,CAAZ,EAAe;AACrB4D,WAAO,kBAAkBpE,KAAKiB,IAAvB,GAA8B,KAA9B,GAAsCqD,UAAUtE,KAAK+B,MAAf,CAAtC,GAA+D,SAAtE;AACA,GAFM,MAEA,IAAIvB,QAAQ,CAAZ,EAAe;AACrB,UAAMc,MAAMtB,KAAKiD,GAAL,CAASoB,KAAKC,UAAUD,CAAV,CAAd,EAA4B9C,IAA5B,CAAiC,EAAjC,CAAZ;AACA6C,WAAO,WAAW9C,MAAM,MAAMA,GAAN,GAAY,SAAlB,GAA8B,IAAzC,CAAP;AACA,GAHM,MAGA,IAAId,QAAQ,CAAZ,EAAe;AACrB,UAAMc,MAAMlB,OAAOyB,OAAP,CAAe7B,IAAf,EAAqB6D,MAArB,CAA4B,UAAUW,CAAV,EAAYH,CAAZ,EAAe;AACtD,aAAOG,IAAIF,UAAU;AAAErD,cAAMoD,EAAE,CAAF,CAAR;AAActC,gBAAQuC,UAAUD,EAAE,CAAF,CAAV;AAAtB,OAAV,CAAX;AACA,KAFW,EAEV,EAFU,CAAZ;AAGAD,WAAO,WAAW9C,MAAM,MAAMA,GAAN,GAAY,SAAlB,GAA8B,IAAzC,CAAP;AACA,GALM,MAKA,IAAId,QAAQ,EAAR,IAAcA,QAAQ,EAA1B,EAA8B;AACpC,UAAMc,MAAMtB,KAAKL,eAAL,EAAsBkE,MAAtB,CAA6B,CAACW,CAAD,EAAGH,CAAH,KAASG,IAAIF,UAAUD,CAAV,CAA1C,EAAuD,EAAvD,CAAZ;;AACA,QAAG7D,QAAQ,EAAX,EAAe;AACd4D,aAAO,kBAAkBpE,KAAKP,eAAL,CAAlB,GAA0C,IAA1C,IAAkD6B,MAAM,MAAMA,GAAN,GAAY,SAAlB,GAA8B,IAAhF,CAAP;AACA,KAFD,MAEO;AACN8C,aAAO,WAAW9C,MAAM,MAAMA,GAAN,GAAY,SAAlB,GAA8B,IAAzC,CAAP;AACA;AACD,GAPM,MAOA;AACN,QAAId,QAAQ,CAAZ,EAAe;AACd4D,aAAO,OAAOpE,KAAKJ,kBAAkB,CAAlB,CAAL,CAAP,GAAoC,IAA3C;AACA,KAFD,MAEO,IAAIY,QAAQ,CAAZ,EAAe;AACrB4D,aAAO,SAASpE,KAAKJ,kBAAkB,CAAlB,CAAL,CAAT,GAAsC,KAA7C;AACA,KAFM,MAEA,IAAIY,QAAQ,EAAZ,EAAgB;AACtB4D,aAAO,eAAapE,KAAKJ,kBAAkB,EAAlB,CAAL,CAAb,GAAyC,GAAhD;AACA,KAFM,MAEA;AACN,YAAM0B,MAAMtB,SAAS,IAAT,GAAgB,MAAhB,GAAyBA,IAArC;AACAoE,aAAO5D,QAAQ,EAAR,GAAa,WAAWc,GAAX,GAAiB,SAA9B,GAA0CA,GAAjD;AACA;AACD;;AACD,SAAOiD,aAAaA,WAAWH,GAAX,CAAb,GAA+BA,GAAtC;AACA","sourcesContent":["import { VNode } from \"./vnode\";\r\n\r\nimport multimap from \"./multimap\";\r\n\r\nimport { serialize } from \"./doctype\";\r\n\r\nimport { isBranch, hasName } from \"./type\";\r\n\r\n// import self!\r\nimport * as cx from \"./inode\";\r\n\r\n// helpers ---------------\r\n\r\n//import { q } from \"./qname\";\r\n\r\nconst reservedNameKey = \"$name\"; //[1,2,9,11,14]\r\nconst reservedChildrenKey = \"$children\"; //[1,9,11]\r\nconst reservedArgsKey = \"$args\"; //[14,15]\r\nconst reservedValueKeys = {\r\n\t2:\"$value\",\r\n\t4:\"$ref\",\r\n\t7:\"$pi\",\r\n\t8:\"$comment\",\r\n\t10:\"$doctype\"\r\n};\r\n\r\nconst hashre = /^#/;\r\n\r\nexport const __vnode_context = \"inode\";\r\n\r\nexport function getType(node) {\r\n\tif (node === null) return 12;\r\n\tvar cc = node.constructor;\r\n\tif (cc == Array) {\r\n\t\treturn 5;\r\n\t} else if (cc == Object) {\r\n\t\tif (reservedChildrenKey in node) {\r\n\t\t\tconst name = node[reservedNameKey];\r\n\t\t\treturn !hashre.test(name) ? 1 : name == \"#document\" ? 9 : 11;\r\n\t\t} else if (reservedArgsKey in node) {\r\n\t\t\treturn node[reservedNameKey] !== undefined ? 14 : 15;\r\n\t\t}\r\n\t\tfor(let type in reservedValueKeys) {\r\n\t\t\tif(reservedValueKeys[type] in node) return type;\r\n\t\t}\r\n\t\treturn 6;\r\n\t} else if (cc == Number || cc == Boolean) {\r\n\t\treturn 12;\r\n\t}\r\n\treturn 3;\r\n}\r\n\r\n// -----------------------\r\n\r\nexport function vnode(node, parent, depth, indexInParent, type) {\r\n\ttype = type || getType(node);\r\n\tlet name,key,value;\r\n\tif (isBranch(type)) {\r\n\t\tname = node[reservedNameKey];\r\n\t} else if (type == 2) {\r\n\t\tname = node[reservedNameKey];\r\n\t\tvalue = node[reservedValueKeys[2]];\r\n\t\t// this ensures pairs are iterated as their values (if no $key use attr node for construction)\r\n\t\tif (node.$key) {\r\n\t\t\tkey = node.$key;\r\n\t\t\tnode = value;\r\n\t\t\ttype = getType(node);\r\n\t\t}\r\n\t} else if(type == 3 || type == 12) {\r\n\t\tvalue = node;\r\n\t} else {\r\n\t\tvalue = node[reservedValueKeys[type]];\r\n\t}\r\n\treturn new VNode(cx, node, type, name, key, value, parent, depth, indexInParent);\r\n}\r\n\r\nexport function create(type, nameOrValue) {\r\n\tif(type == 5) return [];\r\n\tif(type == 6) return {};\r\n\tif(type == 3 || type == 12) return nameOrValue;\r\n\tconst node = {};\r\n\tif(hasName(type)) node[reservedNameKey] = nameOrValue;\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tnode[reservedChildrenKey] = [];\r\n\t} else if(type == 14 || type == 15) {\r\n\t\tnode[reservedArgsKey] = [];\r\n\t} else if(type == 2) {\r\n\t\t// value will be inserted later\r\n\t\tnode[reservedValueKeys[2]] = void 0;\r\n\t} else {\r\n\t\tconst val = type == 7 ? nameOrValue.join(\" \") : type == 10 ? serialize(...nameOrValue) : nameOrValue;\r\n\t\tnode[reservedValueKeys[type]] = val;\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function get(node,idx,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 6) {\r\n\t\treturn node[idx];\r\n\t}\r\n\tif(type == 14 || type == 15){\r\n\t\treturn node[reservedArgsKey][idx];\r\n\t}\r\n\treturn node[reservedChildrenKey][idx];\r\n}\r\n\r\nexport function has(node,idx,type) {\r\n\ttype = type || getType(node);\r\n\tif(type == 5 || type == 6) {\r\n\t\treturn idx in node;\r\n\t}\r\n\tif(type == 14 || type == 15){\r\n\t\treturn idx in node[reservedArgsKey];\r\n\t}\r\n\treturn idx in node[reservedChildrenKey];\r\n}\r\n\r\nvar _nextOrPrev = function _nextOrPrev(node, idx, type, dir) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\treturn node[reservedChildrenKey][idx + dir];\r\n\t}\r\n\tif (type == 14 || type == 15) {\r\n\t\treturn node[reservedArgsKey][idx + dir];\r\n\t}\r\n\tif (type == 5) return node[idx + dir];\r\n\tif (type == 6) {\r\n\t\tvar entries = Object.entries(node);\r\n\t\tvar kv = entries[idx + dir];\r\n\t\t// pass pair-wise\r\n\t\treturn { $key: kv[0], $value: kv[1] };\r\n\t}\r\n};\r\n\r\nexport function next(node, vnode, type) {\r\n\treturn _nextOrPrev(node, vnode.indexInParent - 1, type, 1);\r\n}\r\n\r\nexport function previous(node, vnode, type) {\r\n\treturn _nextOrPrev(node, vnode.indexInParent - 1, type, -1);\r\n}\r\n\r\nexport function push(node, [k,v], type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tnode[reservedChildrenKey].push(v);\r\n\t} else if (type == 14 || type == 15) {\r\n\t\tnode[reservedChildrenKey].push(v);\r\n\t} else if (type == 5) {\r\n\t\tnode.push(v);\r\n\t} else if (type == 6) {\r\n\t\tnode[k] = v;\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function set(node,key,val,type) {\r\n\ttype = type || getType(node);\r\n\tif(type == 1 || type == 6) {\r\n\t\tnode[key] = val;\r\n\t\treturn node;\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function removeChild(node, child, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tnode[reservedChildrenKey].splice(child.indexInParent, 1);\r\n\t} else if (type == 5) {\r\n\t\tnode.splice(child.indexInParent, 1);\r\n\t} else if (type == 6) {\r\n\t\tdelete node[child.key];\r\n\t} else if (type == 14 || type == 15) {\r\n\t\tnode[reservedArgsKey].splice(child.indexInParent, 1);\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function cached(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tlet children = node[reservedChildrenKey],\r\n\t\t\tlen = children.length,\r\n\t\t\tcache = multimap();\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tcache.push([children[i][reservedNameKey] || i + 1, children[i]]);\r\n\t\t}\r\n\t\treturn cache;\r\n\t}\r\n\tif (type == 5) {\r\n\t\treturn {\r\n\t\t\tkeys: function keys() {\r\n\t\t\t\treturn node.keys();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\tif (type == 6) {\r\n\t\treturn {\r\n\t\t\tkeys: function keys() {\r\n\t\t\t\treturn Object.keys(node);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport function keys(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9) {\r\n\t\tlet children = node[reservedChildrenKey],\r\n\t\t\tlen = children.length,\r\n\t\t\tkeys = [];\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tkeys[i] = children[i][reservedNameKey] || i + 1;\r\n\t\t}\r\n\t\treturn keys;\r\n\t}\r\n\tif (type == 5) return node.keys();\r\n\tif (type == 6) return Object.keys(node);\r\n\treturn [];\r\n}\r\n\r\nexport function values(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) return node[reservedChildrenKey];\r\n\tif (type == 14 || type == 15) return node[reservedArgsKey];\r\n\tif (type == 2) return [[node[reservedNameKey], node[reservedValueKeys[2]]]];\r\n\tif (type == 6)\r\n\t\t// pair-wise\r\n\t\treturn Object.entries(node).map(function (kv) {\r\n\t\t\treturn { $key: kv[0], $value: kv[1] };\r\n\t\t});\r\n\tif(type == 3 || type == 12) return [node];\r\n\treturn [node[reservedValueKeys[type]]];\r\n}\r\n\r\nexport function finalize(node) {\r\n\treturn node;\r\n}\r\n\r\nexport function count(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\treturn node[reservedChildrenKey].length;\r\n\t} else if (type == 14 || type == 15) {\r\n\t\treturn node[reservedArgsKey].length;\r\n\t} else if (type == 5) {\r\n\t\treturn node.length;\r\n\t} else if (type == 6) {\r\n\t\treturn Object.keys(node).length;\r\n\t}\r\n\treturn 0;\r\n}\r\n\r\nexport function first(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\treturn node[reservedChildrenKey][0];\r\n\t} else if (type == 14 || type == 15) {\r\n\t\treturn node[reservedArgsKey][0];\r\n\t} else if (type == 5) {\r\n\t\treturn node[0];\r\n\t} else if (type == 6) {\r\n\t\tvar entries = Object.entries(node);\r\n\t\tvar kv = entries[0];\r\n\t\t// pass pair-wise\r\n\t\treturn { $key: kv[0], $value: kv[1] };\r\n\t}\r\n}\r\n\r\nexport function last(node, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) return node[reservedChildrenKey].lastItem;\r\n\tif (type == 5) return node.lastItem;\r\n\tif (type == 6) {\r\n\t\tvar entries = Object.entries(node);\r\n\t\tvar kv = entries.lastItem;\r\n\t\t// pass pair-wise\r\n\t\treturn { $key: kv[0], $value: kv[1] };\r\n\t}\r\n\tif (type == 14 || type == 15) return node[reservedArgsKey].lastItem;\r\n}\r\n\r\nconst dollarRE = /^\\$/;\r\n\r\nexport function entries(node, type) {\r\n\ttype = type || getType(node);\r\n\tif(type == 5) return node.entries();\r\n\tif(type == 6) return Object.entries(node);\r\n\tif (type == 1 || type == 6 || type == 9 || type == 11) return Object.entries(node).filter(([k]) => !dollarRE.test(k));\r\n\treturn [];\r\n}\r\n\r\nexport function modify(node, vnode, ref, type) {\r\n\ttype = type || getType(node);\r\n\tif (type == 1 || type == 9 || type == 11) {\r\n\t\tif (vnode.type == 2) {\r\n\t\t\t// TODO conversion rules!\r\n\t\t\tnode[vnode.name] = vnode.node.$value + \"\";\r\n\t\t} else if (ref !== undefined) {\r\n\t\t\tnode[reservedChildrenKey].splice(ref.indexInParent, 0, vnode.node);\r\n\t\t} else {\r\n\t\t\tnode[reservedChildrenKey].push(vnode.node);\r\n\t\t}\r\n\t} else if (type == 14 || type == 15) {\r\n\t\tif (ref !== undefined) {\r\n\t\t\tnode[reservedArgsKey].splice(ref.indexInParent, 0, vnode.node);\r\n\t\t} else {\r\n\t\t\tnode[reservedArgsKey].push(vnode.node);\r\n\t\t}\r\n\t} else if (type == 2) {\r\n\t\tnode[reservedValueKeys[2]] = vnode.node;\r\n\t} else if (type == 5) {\r\n\t\tif (ref !== undefined) {\r\n\t\t\tnode.splice(ref.indexInParent, 0, vnode.node);\r\n\t\t} else {\r\n\t\t\tnode.push(vnode.node);\r\n\t\t}\r\n\t} else if (type == 6) {\r\n\t\tnode[vnode.name] = vnode.node[reservedValueKeys[2]];\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function toJS(node,type) {\r\n\ttype = type || getType(node);\r\n\tif(type == 5) {\r\n\t\treturn node.map(x => toJS(x));\r\n\t} else if(type == 6) {\r\n\t\treturn Object.entries(node).reduce((acc,[k,v]) => {\r\n\t\t\tacc[k] = toJS(v);\r\n\t\t\treturn acc;\r\n\t\t},{});\r\n\t} else {\r\n\t\treturn node.valueOf();\r\n\t}\r\n}\r\n\r\n\r\nfunction _elemToString(e) {\r\n\tconst attrFunc = (z, [k,v]) => {\r\n\t\tif(/^\\$/.test(k)) return z;\r\n\t\treturn z + (\" \" + k + \"=\\\"\" + v + \"\\\"\");\r\n\t};\r\n\tconst name = e[reservedNameKey];\r\n\tvar str = \"<\" + name;\r\n\tstr = Object.entries(e).reduce(attrFunc, str);\r\n\tconst children = e[reservedChildrenKey];\r\n\tif (children.length > 0) {\r\n\t\tstr += \">\";\r\n\t\tfor(let c of children){\r\n\t\t\tstr += stringify(c);\r\n\t\t}\r\n\t\tstr += \"</\" + name + \">\";\r\n\t} else {\r\n\t\tstr += \"/>\";\r\n\t}\r\n\treturn str;\r\n}\r\n\r\n// FIXME XML or HTML?\r\n// TODO ref type\r\nexport function stringify(node, type, prettifier) {\r\n\tvar str = \"\";\r\n\ttype = type || getType(node);\r\n\tif (type == 1) {\r\n\t\tstr += _elemToString(node);\r\n\t} else if(type == 9 || type == 11) {\r\n\t\tstr = node[reservedChildrenKey].map(c => stringify(c)).join(\"\");\r\n\t} else if (type == 2) {\r\n\t\tstr += \"<l3:a name=\\\"\" + node.$key + \"\\\">\" + stringify(node.$value) + \"</l3:a>\";\r\n\t} else if (type == 5) {\r\n\t\tconst val = node.map(c => stringify(c)).join(\"\");\r\n\t\tstr += \"<l3:l\" + (val ? \">\" + val + \"</l3:l>\" : \"/>\");\r\n\t} else if (type == 6) {\r\n\t\tconst val = Object.entries(node).reduce(function (a,c) {\r\n\t\t\treturn a + stringify({ $key: c[0], $value: stringify(c[1]) });\r\n\t\t},\"\");\r\n\t\tstr += \"<l3:m\" + (val ? \">\" + val + \"</l3:m>\" : \"/>\");\r\n\t} else if (type == 14 || type == 15) {\r\n\t\tconst val = node[reservedArgsKey].reduce((a,c) => a + stringify(c),\"\");\r\n\t\tif(type == 14) {\r\n\t\t\tstr += \"<l3:f name=\\\"\" + node[reservedNameKey] + \"\\\"\" + (val ? \">\" + val + \"</l3:f>\" : \"/>\");\r\n\t\t} else {\r\n\t\t\tstr += \"<l3:q\" + (val ? \">\" + val + \"</l3:q>\" : \"/>\");\r\n\t\t}\r\n\t} else {\r\n\t\tif (type == 7) {\r\n\t\t\tstr += \"<?\" + node[reservedValueKeys[7]] + \"?>\";\r\n\t\t} else if (type == 8) {\r\n\t\t\tstr += \"<!--\" + node[reservedValueKeys[8]] + \"-->\";\r\n\t\t} else if (type == 10) {\r\n\t\t\tstr += \"<!DOCTYPE \"+node[reservedValueKeys[10]]+\">\";\r\n\t\t} else {\r\n\t\t\tconst val = node === null ? \"null\" : node;\r\n\t\t\tstr += type == 12 ? \"<l3:x>\" + val + \"</l3:x>\" : val;\r\n\t\t}\r\n\t}\r\n\treturn prettifier ? prettifier(str) : str;\r\n}\r\n"],"file":"inode.js"}