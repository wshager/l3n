{"version":3,"sources":["../src/vnode.js"],"names":["VNode","constructor","cx","node","type","name","key","value","parent","depth","indexInParent","cache","__is_VNode","toString","prettifier","x","stringify","toJS","count","cached","keys","values","first","last","next","vnode","previous","push","kv","set","val","get","has","removeChild","child","finalize","entries","modify","ref","create","attrs","Close","isVNode","n","getContext","_this","defaultCx","__vnode_context"],"mappings":";;;;;;;AAAA;;;;AAIO,MAAMA,KAAN,CAAY;AAClB;;;;;;;;;;;;;;AAcAC,cAAYC,EAAZ,EAAgBC,IAAhB,EAAsBC,IAAtB,EAA4BC,IAA5B,EAAkCC,GAAlC,EAAuCC,KAAvC,EAA8CC,MAA9C,EAAsDC,KAAtD,EAA6DC,aAA7D,EAA4EC,KAA5E,EAAmF;AAClF,SAAKT,EAAL,GAAUA,EAAV;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKC,GAAL,GAAWA,GAAX;AACA,SAAKC,KAAL,GAAaA,KAAb;AACA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKC,KAAL,GAAaA,QAAQ,CAArB;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACA,SAAKC,KAAL,GAAaA,KAAb;AACA,SAAKC,UAAL,GAAkB,IAAlB;AACA;AACD;;;;;;;AAKAC,WAASC,aAAaC,KAAKA,CAA3B,EAA8B;AAC7B,WAAO,KAAKb,EAAL,CAAQc,SAAR,CAAkB,KAAKb,IAAvB,EAA4B,KAAKC,IAAjC,EAAsCU,UAAtC,CAAP;AACA;AACD;;;;;;AAIAG,SAAO;AACN,WAAO,KAAKf,EAAL,CAAQe,IAAR,CAAa,KAAKd,IAAlB,EAAuB,KAAKC,IAA5B,CAAP;AACA;AACD;;;;;;AAIAc,UAAQ;AACP,QAAI,OAAO,KAAKf,IAAZ,IAAoB,UAAxB,EAAoC,OAAO,CAAP;AACpC,QAAI,CAAC,KAAKQ,KAAV,EAAiB,KAAKA,KAAL,GAAa,KAAKT,EAAL,CAAQiB,MAAR,CAAe,KAAKhB,IAApB,EAA0B,KAAKC,IAA/B,CAAb;AACjB,WAAO,KAAKF,EAAL,CAAQgB,KAAR,CAAc,KAAKf,IAAnB,EAAyB,KAAKC,IAA9B,EAAoC,KAAKO,KAAzC,CAAP;AACA;AACD;;;;;;AAIAS,SAAO;AACN,QAAI,CAAC,KAAKT,KAAV,EAAiB,KAAKA,KAAL,GAAa,KAAKT,EAAL,CAAQiB,MAAR,CAAe,KAAKhB,IAApB,EAA0B,KAAKC,IAA/B,CAAb;AACjB,WAAO,KAAKF,EAAL,CAAQkB,IAAR,CAAa,KAAKjB,IAAlB,EAAwB,KAAKC,IAA7B,EAAmC,KAAKO,KAAxC,CAAP;AACA;AACD;;;;;;AAIAU,WAAS;AACR,QAAI,CAAC,KAAKV,KAAV,EAAiB,KAAKA,KAAL,GAAa,KAAKT,EAAL,CAAQiB,MAAR,CAAe,KAAKhB,IAApB,EAA0B,KAAKC,IAA/B,CAAb;AACjB,WAAO,KAAKF,EAAL,CAAQmB,MAAR,CAAe,KAAKlB,IAApB,EAA0B,KAAKC,IAA/B,EAAqC,KAAKO,KAA1C,CAAP;AACA;AACD;;;;;;AAIAW,UAAQ;AACP,QAAI,CAAC,KAAKX,KAAV,EAAiB,KAAKA,KAAL,GAAa,KAAKT,EAAL,CAAQiB,MAAR,CAAe,KAAKhB,IAApB,EAA0B,KAAKC,IAA/B,CAAb;AACjB,WAAO,KAAKF,EAAL,CAAQoB,KAAR,CAAc,KAAKnB,IAAnB,EAAyB,KAAKC,IAA9B,EAAoC,KAAKO,KAAzC,CAAP;AACA;AACD;;;;;;AAIAY,SAAO;AACN,QAAI,CAAC,KAAKZ,KAAV,EAAiB,KAAKA,KAAL,GAAa,KAAKT,EAAL,CAAQiB,MAAR,CAAe,KAAKhB,IAApB,EAA0B,KAAKC,IAA/B,CAAb;AACjB,WAAO,KAAKF,EAAL,CAAQqB,IAAR,CAAa,KAAKpB,IAAlB,EAAwB,KAAKC,IAA7B,EAAmC,KAAKO,KAAxC,CAAP;AACA;AACD;;;;;;AAIAa,OAAKC,KAAL,EAAY;AACX,QAAI,CAAC,KAAKd,KAAV,EAAiB,KAAKA,KAAL,GAAa,KAAKT,EAAL,CAAQiB,MAAR,CAAe,KAAKhB,IAApB,EAA0B,KAAKC,IAA/B,CAAb;AACjB,WAAO,KAAKF,EAAL,CAAQsB,IAAR,CAAa,KAAKrB,IAAlB,EAAwBsB,KAAxB,EAA+B,KAAKrB,IAApC,EAA0C,KAAKO,KAA/C,CAAP;AACA;AACD;;;;;;AAIAe,WAASD,KAAT,EAAgB;AACf,QAAI,CAAC,KAAKd,KAAV,EAAiB,KAAKA,KAAL,GAAa,KAAKT,EAAL,CAAQiB,MAAR,CAAe,KAAKhB,IAApB,EAA0B,KAAKC,IAA/B,CAAb;AACjB,WAAO,KAAKF,EAAL,CAAQwB,QAAR,CAAiB,KAAKvB,IAAtB,EAA4BsB,KAA5B,EAAmC,KAAKrB,IAAxC,EAA8C,KAAKO,KAAnD,CAAP;AACA;AACD;;;;;;AAIAgB,OAAKC,EAAL,EAAS;AACR;AACA,SAAKzB,IAAL,GAAY,KAAKD,EAAL,CAAQyB,IAAR,CAAa,KAAKxB,IAAlB,EAAwByB,EAAxB,EAA4B,KAAKxB,IAAjC,CAAZ;AACA,WAAO,IAAP;AACA;AACD;;;;;;AAIAyB,MAAIvB,GAAJ,EAASwB,GAAT,EAAc;AACb,SAAK3B,IAAL,GAAY,KAAKD,EAAL,CAAQ2B,GAAR,CAAY,KAAK1B,IAAjB,EAAuBG,GAAvB,EAA4BwB,GAA5B,EAAiC,KAAK1B,IAAtC,CAAZ;AACA,WAAO,IAAP;AACA;AACD;;;;;;AAIA2B,MAAIzB,GAAJ,EAAS;AACR,WAAO,KAAKJ,EAAL,CAAQ6B,GAAR,CAAY,KAAK5B,IAAjB,EAAuBG,GAAvB,EAA4B,KAAKF,IAAjC,CAAP;AACA;AACD;;;;;;AAIA4B,MAAI1B,GAAJ,EAAS;AACR,WAAO,KAAKJ,EAAL,CAAQ8B,GAAR,CAAY,KAAK7B,IAAjB,EAAuBG,GAAvB,EAA4B,KAAKF,IAAjC,CAAP;AACA;AACD;;;;;;AAIA6B,cAAYC,KAAZ,EAAmB;AAClB,SAAK/B,IAAL,GAAY,KAAKD,EAAL,CAAQ+B,WAAR,CAAoB,KAAK9B,IAAzB,EAA+B+B,KAA/B,EAAsC,KAAK9B,IAA3C,CAAZ;AACA,WAAO,IAAP;AACA;AACD;;;;;;AAIA+B,aAAW;AACV,SAAKhC,IAAL,GAAY,KAAKD,EAAL,CAAQiC,QAAR,CAAiB,KAAKhC,IAAtB,CAAZ;AACA,WAAO,IAAP;AACA;AACD;;;;;;AAIAiC,YAAU;AACT,WAAO,KAAKlC,EAAL,CAAQkC,OAAR,CAAgB,KAAKjC,IAArB,CAAP;AACA;AACD;;;;;;AAIAkC,SAAOlC,IAAP,EAAamC,GAAb,EAAkB;AACjB,SAAKnC,IAAL,GAAY,KAAKD,EAAL,CAAQmC,MAAR,CAAe,KAAKlC,IAApB,EAA0BA,IAA1B,EAAgCmC,GAAhC,EAAqC,KAAKlC,IAA1C,CAAZ;AACA,WAAO,IAAP;AACA;AACD;;;;;;AAIAqB,QAAMtB,IAAN,EAAYK,MAAZ,EAAoBC,KAApB,EAA2BC,aAA3B,EAA0C;AACzC;AACA,WAAO,KAAKR,EAAL,CAAQuB,KAAR,CAActB,IAAd,EAAoBK,MAApB,EAA4BC,KAA5B,EAAmCC,aAAnC,CAAP;AACA;AACD;;;;;;AAIA6B,SAAOnC,IAAP,EAAaC,IAAb,EAAmBmC,KAAnB,EAA0B;AACzB,WAAO,KAAKtC,EAAL,CAAQqC,MAAR,CAAenC,IAAf,EAAqBC,IAArB,EAA2BmC,KAA3B,CAAP;AACA;;AAhLiB;AAmLnB;;;;;;;;AAIO,MAAMC,KAAN,CAAY;AAClB;;;;;AAKAxC,cAAYE,IAAZ,EAAkB;AACjB,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKK,MAAL,GAAcL,KAAKK,MAAnB;AACA,SAAKC,KAAL,GAAaN,KAAKM,KAAlB;AACA,SAAKC,aAAL,GAAqBP,KAAKO,aAA1B;AACA,SAAKN,IAAL,GAAY,EAAZ;AACA,SAAKQ,UAAL,GAAkB,IAAlB;AACA;AACD;;;;;;AAIAC,aAAW;AACV,WAAQ,iBAAgB,KAAKV,IAAL,CAAUM,KAAM,aAAY,KAAKN,IAAK,GAA9D;AACA;;AApBiB;AAuBnB;;;;;;;;;AAKO,MAAMuC,UAAUC,KAAK,CAAC,CAACA,CAAF,IAAOA,EAAE/B,UAA9B;AAEP;;;;;;;;;;;AAOO,MAAMgC,aAAa,CAACC,KAAD,EAAOC,SAAP,KAAqBD,SAASA,MAAME,eAAf,GAAiCF,KAAjC,GAAyCC,SAAjF","sourcesContent":["/**\r\n * core interface to communicate with nodes\r\n * @type VNode\r\n */\r\nexport class VNode {\r\n\t/**\r\n\t * Create VNode\r\n\t * @param  {Object} cx            Document implementation context\r\n\t * @param  {Object} node          Bare node\r\n\t * @param  {Number} type          Node type\r\n\t * @param  {String} name          Node name (if available)\r\n\t * @param  {String} key           Node key (available on pairs in objects only)\r\n\t * @param  {any} value            Node value (available on leafs only)\r\n\t * @param  {VNode} parent         Parent in the document\r\n\t * @param  {Number} deptht        Depth relative to the document\r\n\t * @param  {Number} indexInParent Position relative to the parent\r\n\t * @param  {Object} cache         Optional cache for fast access\r\n\t * @return {void}\r\n\t */\r\n\tconstructor(cx, node, type, name, key, value, parent, depth, indexInParent, cache) {\r\n\t\tthis.cx = cx;\r\n\t\tthis.node = node;\r\n\t\tthis.type = type;\r\n\t\tthis.name = name;\r\n\t\tthis.key = key;\r\n\t\tthis.value = value;\r\n\t\tthis.parent = parent;\r\n\t\tthis.depth = depth | 0;\r\n\t\tthis.indexInParent = indexInParent;\r\n\t\tthis.cache = cache;\r\n\t\tthis.__is_VNode = true;\r\n\t}\r\n\t/**\r\n\t * Render XML representation of a VNode\r\n\t * @param  {Function} prettifier=x => x Optional prettifier function\r\n\t * @return {String}               Output\r\n\t */\r\n\ttoString(prettifier = x => x) {\r\n\t\treturn this.cx.stringify(this.node,this.type,prettifier);\r\n\t}\r\n\t/**\r\n\t * Return JS (JSON) representation (by default this returns the bare document structure)\r\n\t * @return {any} [description]\r\n\t */\r\n\ttoJS() {\r\n\t\treturn this.cx.toJS(this.node,this.type);\r\n\t}\r\n\t/**\r\n\t * Interface to context's count function\r\n\t * @return {Number} Count of the node's entries or children\r\n\t */\r\n\tcount() {\r\n\t\tif (typeof this.node == \"function\") return 0;\r\n\t\tif (!this.cache) this.cache = this.cx.cached(this.node, this.type);\r\n\t\treturn this.cx.count(this.node, this.type, this.cache);\r\n\t}\r\n\t/**\r\n\t * Interface to context's keys function\r\n\t * @return {Array} Keys of the node's entries or children\r\n\t */\r\n\tkeys() {\r\n\t\tif (!this.cache) this.cache = this.cx.cached(this.node, this.type);\r\n\t\treturn this.cx.keys(this.node, this.type, this.cache);\r\n\t}\r\n\t/**\r\n\t * Interface to context's values function\r\n\t * @return {Array} The node's values, children or arguments\r\n\t */\r\n\tvalues() {\r\n\t\tif (!this.cache) this.cache = this.cx.cached(this.node, this.type);\r\n\t\treturn this.cx.values(this.node, this.type, this.cache);\r\n\t}\r\n\t/**\r\n\t * Interface to context's first function\r\n\t * @return {any} The node's first child, if any\r\n\t */\r\n\tfirst() {\r\n\t\tif (!this.cache) this.cache = this.cx.cached(this.node, this.type);\r\n\t\treturn this.cx.first(this.node, this.type, this.cache);\r\n\t}\r\n\t/**\r\n\t * Interface to context's last function\r\n\t * @return {any} The node's last child, if any\r\n\t */\r\n\tlast() {\r\n\t\tif (!this.cache) this.cache = this.cx.cached(this.node, this.type);\r\n\t\treturn this.cx.last(this.node, this.type, this.cache);\r\n\t}\r\n\t/**\r\n\t * Interface to context's next function\r\n\t * @return {any} The node's next child relative to the provided VNode, if any\r\n\t */\r\n\tnext(vnode) {\r\n\t\tif (!this.cache) this.cache = this.cx.cached(this.node, this.type);\r\n\t\treturn this.cx.next(this.node, vnode, this.type, this.cache);\r\n\t}\r\n\t/**\r\n\t * Interface to context's previous function\r\n\t * @return {any} The node's previous child relative to the provided VNode, if any\r\n\t */\r\n\tprevious(vnode) {\r\n\t\tif (!this.cache) this.cache = this.cx.cached(this.node, this.type);\r\n\t\treturn this.cx.previous(this.node, vnode, this.type, this.cache);\r\n\t}\r\n\t/**\r\n\t * Interface to context's push function\r\n\t * @return {VNode} pushes the tuple onto the node's entries or children\r\n\t */\r\n\tpush(kv) {\r\n\t\t// TODO cache invalidation\r\n\t\tthis.node = this.cx.push(this.node, kv, this.type);\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t * Interface to context's set function\r\n\t * @return {VNode} inserts the pair into a node that can contain pairs\r\n\t */\r\n\tset(key, val) {\r\n\t\tthis.node = this.cx.set(this.node, key, val, this.type);\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t * Interface to context's get function\r\n\t * @return {any} retrieves a node's entry or child by key or index\r\n\t */\r\n\tget(key) {\r\n\t\treturn this.cx.get(this.node, key, this.type);\r\n\t}\r\n\t/**\r\n\t * Interface to context's has function\r\n\t * @return {Boolean} checks if a node has an entry or child with provided key or index\r\n\t */\r\n\thas(key) {\r\n\t\treturn this.cx.has(this.node, key, this.type);\r\n\t}\r\n\t/**\r\n\t * Interface to context's removeChild function\r\n\t * @return {VNode} removes a node's entry or child\r\n\t */\r\n\tremoveChild(child) {\r\n\t\tthis.node = this.cx.removeChild(this.node, child, this.type);\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t * Interface to context's finalize function\r\n\t * @return {VNode} finalizes a node that's eligible for transient mutations\r\n\t */\r\n\tfinalize() {\r\n\t\tthis.node = this.cx.finalize(this.node);\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t * Interface to context's entries function\r\n\t * @return {Array} retrieves a node's entries (i.e. attributes), if any\r\n\t */\r\n\tentries() {\r\n\t\treturn this.cx.entries(this.node);\r\n\t}\r\n\t/**\r\n\t * Interface to context's modify function\r\n\t * @return {VNode} modifies a node's entries or children, if any\r\n\t */\r\n\tmodify(node, ref) {\r\n\t\tthis.node = this.cx.modify(this.node, node, ref, this.type);\r\n\t\treturn this;\r\n\t}\r\n\t/**\r\n\t * Interface to context's vnode function\r\n\t * @return {VNode} allows for the creation of VNode with the same context bound it as this one\r\n\t */\r\n\tvnode(node, parent, depth, indexInParent) {\r\n\t\t// hitch this on VNode for reuse\r\n\t\treturn this.cx.vnode(node, parent, depth, indexInParent);\r\n\t}\r\n\t/**\r\n\t * Interface to context's create function\r\n\t * @return {any} allows for the creation of bare nodes within the bound context\r\n\t */\r\n\tcreate(type, name, attrs) {\r\n\t\treturn this.cx.create(type, name, attrs);\r\n\t}\r\n}\r\n\r\n/**\r\n * Create a VNode that explicitly closes a branch\r\n * @type {Close}\r\n */\r\nexport class Close {\r\n\t/**\r\n\t * Create a Close\r\n\t * @param  {VNode} node The VNode that is closed\r\n\t * @return {void}\r\n\t */\r\n\tconstructor(node) {\r\n\t\tthis.node = node;\r\n\t\tthis.parent = node.parent;\r\n\t\tthis.depth = node.depth;\r\n\t\tthis.indexInParent = node.indexInParent;\r\n\t\tthis.type = 17;\r\n\t\tthis.__is_VNode = true;\r\n\t}\r\n\t/**\r\n\t * Helper method to visualize the branch closer\r\n\t * @return {String} Output\r\n\t */\r\n\ttoString() {\r\n\t\treturn `Close {depth: ${this.node.depth}, closes: ${this.node}}`;\r\n\t}\r\n}\r\n\r\n/**\r\n * Test if VNode\r\n * @param  {any}  n Object to test\r\n * @return {Boolean}\r\n */\r\nexport const isVNode = n => !!n && n.__is_VNode;\r\n\r\n/**\r\n * Helper function to determine the currently bound document implementation context\r\n * Returns the provided default context if none is bound\r\n * @param  {any} _this     Reference to functions this scope\r\n * @param  {Object} defaultCx Default document implementation context\r\n * @return {Object}           currently bound context\r\n */\r\nexport const getContext = (_this,defaultCx) => _this && _this.__vnode_context ? _this : defaultCx;\r\n"],"file":"vnode.js"}