{"version":3,"sources":["../src/doc.js"],"names":["ensureDoc","d","t","doctype","inode","$node","cx","pipe","node","type","getType","root","first","vnode","doc","bind","_root","push","next","depth","children","name","publicId","systemId"],"mappings":";;;;;QAUgBA,S,GAAAA,S;QA+BAC,C,GAAAA,C;QAIAC,C,GAAAA,C;QAIAC,O,GAAAA,O;;AAjDhB;;AAEA;;AAEA;;AAEA;;;;AAEA;;IAAYC,K;;;;;;AAEL,SAASJ,SAAT,CAAmBK,KAAnB,EAA0B;AAChC;AACA,KAAIC,KAAK,uBAAW,IAAX,EAAgBF,KAAhB,CAAT;AACA,QAAO,oBAAKC,KAAL,EAAYE,IAAZ,CAAiB,0BAAU,UAAUC,IAAV,EAAgB;AACjD,MAAI,CAACA,KAAKA,IAAV,EAAgB;AACf,OAAIC,OAAOH,GAAGI,OAAH,CAAWF,IAAX,CAAX;AACA,OAAIC,QAAQ,CAAR,IAAaA,QAAQ,EAAzB,EAA6B;AAC5B,QAAIE,OAAOL,GAAGM,KAAH,CAASJ,IAAT,CAAX;AACA,WAAO,oBAAKF,GAAGO,KAAH,CAASF,IAAT,EAAeL,GAAGO,KAAH,CAASL,IAAT,CAAf,EAA+B,CAA/B,EAAkC,CAAlC,CAAL,CAAP;AACA,IAHD,MAGO;AACN;AACA,QAAIM,MAAMZ,EAAEa,IAAF,CAAOT,EAAP,GAAV;AACA,QAAIU,QAAQV,GAAGO,KAAH,CAASL,IAAT,EAAeM,GAAf,EAAoB,CAApB,EAAuB,CAAvB,CAAZ;AACA,WAAO,oBAAKA,GAAL,EAAUP,IAAV,CAAe,0BAAU,UAAUO,GAAV,EAAe;AAC9CA,WAAMA,IAAIG,IAAJ,CAAS,CAAC,CAAD,EAAID,MAAMR,IAAV,CAAT,CAAN;AACA,SAAIU,OAAOJ,IAAIF,KAAJ,EAAX;AACA,YAAOM,OAAO,oBAAKJ,IAAID,KAAJ,CAAUK,IAAV,EAAgBJ,GAAhB,EAAqBA,IAAIK,KAAJ,GAAY,CAAjC,EAAoC,CAApC,CAAL,CAAP,GAAsD,qBAA7D;AACA,KAJqB,CAAf,CAAP;AAKA;AACD;AACD,MAAI,OAAOX,KAAKA,IAAZ,KAAqB,UAAzB,EAAqC;AACpC;AACA,UAAO,oBAAKN,EAAEa,IAAF,CAAOT,EAAP,EAAWE,IAAX,CAAL,EAAuBD,IAAvB,CAA4B,0BAAU,UAAUC,IAAV,EAAgB;AAC5D,QAAIU,OAAOV,KAAKI,KAAL,EAAX;AACA,WAAOM,OAAO,oBAAKV,KAAKK,KAAL,CAAWK,IAAX,EAAiBV,IAAjB,EAAuBA,KAAKW,KAAL,GAAa,CAApC,EAAuC,CAAvC,CAAL,CAAP,GAAyD,qBAAhE;AACA,IAHkC,CAA5B,CAAP;AAIA;AACD,SAAO,oBAAKX,IAAL,CAAP;AACA,EAzBuB,CAAjB,CAAP;AA0BA;;AAEM,SAASP,CAAT,CAAW,GAAGmB,QAAd,EAAwB;AAC9B,QAAO,6BAAG,CAAH,EAAM,WAAN,EAAmBA,QAAnB,EAA6BZ,IAA7B,CAAkC,uBAAW,IAAX,EAAgBJ,KAAhB,CAAlC,CAAP;AACA;;AAEM,SAASF,CAAT,CAAW,GAAGkB,QAAd,EAAwB;AAC9B,QAAO,6BAAG,EAAH,EAAO,oBAAP,EAA4BA,QAA5B,EAAsCZ,IAAtC,CAA2C,uBAAW,IAAX,EAAgBJ,KAAhB,CAA3C,CAAP;AACA;;AAEM,SAASD,OAAT,CAAiBkB,IAAjB,EAAsBC,WAAS,EAA/B,EAAkCC,WAAS,EAA3C,EAA8C;AACpD,QAAO,6BAAG,EAAH,EAAM,CAACF,IAAD,EAAMC,QAAN,EAAeC,QAAf,CAAN,CAAP;AACA","file":"doc.js","sourcesContent":["import { concatMap } from \"rxjs/operators\";\n\nimport { getContext } from \"./vnode\";\n\nimport { _n, _v } from \"./construct-impl-strict\";\n\nimport just from \"./just\";\n\nimport * as inode from \"./inode\";\n\nexport function ensureDoc($node) {\n\t// FIXME if isVNode(node) use cx on node\n\tvar cx = getContext(this,inode);\n\treturn just($node).pipe(concatMap(function (node) {\n\t\tif (!node.node) {\n\t\t\tvar type = cx.getType(node);\n\t\t\tif (type == 9 || type == 11) {\n\t\t\t\tvar root = cx.first(node);\n\t\t\t\treturn just(cx.vnode(root, cx.vnode(node), 1, 0));\n\t\t\t} else {\n\t\t\t\t// create a document-fragment by default!\n\t\t\t\tvar doc = t.bind(cx)();\n\t\t\t\tvar _root = cx.vnode(node, doc, 1, 0);\n\t\t\t\treturn just(doc).pipe(concatMap(function (doc) {\n\t\t\t\t\tdoc = doc.push([0, _root.node]);\n\t\t\t\t\tvar next = doc.first();\n\t\t\t\t\treturn next ? just(doc.vnode(next, doc, doc.depth + 1, 0)) : just();\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\t\tif (typeof node.node === \"function\") {\n\t\t\t// NOTE never bind to current node.cx, but purposely allow cross-binding\n\t\t\treturn just(t.bind(cx)(node)).pipe(concatMap(function (node) {\n\t\t\t\tvar next = node.first();\n\t\t\t\treturn next ? just(node.vnode(next, node, node.depth + 1, 0)) : just();\n\t\t\t}));\n\t\t}\n\t\treturn just(node);\n\t}));\n}\n\nexport function d(...children) {\n\treturn _n(9, \"#document\", children).node(getContext(this,inode));\n}\n\nexport function t(...children) {\n\treturn _n(11, \"#document-fragment\",children).node(getContext(this,inode));\n}\n\nexport function doctype(name,publicId=\"\",systemId=\"\"){\n\treturn _v(10,[name,publicId,systemId]);\n}\n"]}