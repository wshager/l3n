{"version":3,"sources":["../src/dom.js"],"names":["wsre","ignoreWS","x","nodeType","test","textContent","filterWS","l3re","getL3Type","name","matches","exec","toLowerCase","i","l","length","constructors","getQName","node","indexInParent","nodeName","l3Type","isL3","attrs","attributes","__vnode_context","vnode","parent","depth","isElem","type","key","value","data","VNode","cx","create","nameOrValue","document","implementation","createDocument","createDocumentType","createDocumentFragment","elem","createElement","createAttribute","createTextNode","setAttribute","createProcessingInstruction","createComment","get","idx","getType","childNodes","has","next","nxt","nextSibling","undefined","previous","prv","previousSibling","push","kv","appendChild","set","val","attr","removeChild","vchild","cached","keys","children","len","toArray","c","getAttribute","values","finalize","count","first","last","lastItem","entries","a","err","modify","ref","$value","setAttributeNode","insertBefore","stringify","join","outerHTML","publicId","systemId","text"],"mappings":"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","sourcesContent":["import { VNode } from \"./vnode\";\r\n\r\nimport { isBranch } from \"./type\";\r\n\r\nimport { serialize } from \"./doctype\";\r\n\r\nimport { range, filter, map } from \"./array-util\";\r\n\r\n// import self!\r\nimport * as cx from \"./dom\";\r\n\r\n// helpers ---------------\r\nconst wsre = /^[\\t\\n\\r ]*$/;\r\nconst ignoreWS = x => x.nodeType != 3 || !wsre.test(x.textContent);\r\nconst filterWS = filter(ignoreWS);\r\n\r\nconst l3re = /^l3-(e?)(a?)(x?)(r?)(l?)(m?)(p?)(c?)()()(d?)()()(f?)(q?)$/;\r\nconst getL3Type = name => {\r\n\tconst matches = l3re.exec(name.toLowerCase());\r\n\tif(!matches) return 0;\r\n\tfor (let i = 1, l = matches.length; i < l; i++) {\r\n\t\tif (matches[i]) return i;\r\n\t}\r\n\treturn 0;\r\n};\r\n\r\nconst constructors = {\r\n\t1: \"e\",\r\n\t2: \"a\",\r\n\t3: \"x\",\r\n\t4: \"r\",\r\n\t5: \"l\",\r\n\t6: \"m\",\r\n\t7: \"p\",\r\n\t8: \"c\",\r\n\t12: \"x\",\r\n\t14: \"f\",\r\n\t15: \"q\"\r\n};\r\n\r\nvar getQName = function getQName(node, indexInParent) {\r\n\tvar nodeType = node.nodeType;\r\n\tvar nodeName = node.nodeName;\r\n\tif (nodeType == 1) {\r\n\t\tvar l3Type = getL3Type(nodeName);\r\n\t\t//let type = l3Type | nodeType;\r\n\t\tvar isL3 = l3Type !== 0;\r\n\t\tvar attrs = node.attributes;\r\n\t\treturn isL3 ? attrs.name : nodeName;\r\n\t} else {\r\n\t\treturn indexInParent + 1;\r\n\t}\r\n};\r\n\r\n//import { qname } from \"./qname\";\r\n\r\n// -----------------------\r\n// Core API\r\n// -----------------------\r\nexport const __vnode_context = \"dom\";\r\n\r\nexport function vnode(node, parent, depth, indexInParent) {\r\n\tvar nodeType = node.nodeType;\r\n\tvar nodeName = node.nodeName;\r\n\tlet isElem = nodeType == 1;\r\n\tvar l3Type = isElem ? getL3Type(nodeName) : 0;\r\n\tlet type = l3Type || nodeType;\r\n\tvar isL3 = isElem && l3Type !== 0;\r\n\tvar attrs = isElem ? node.attributes : null;\r\n\tvar name, key, value;\r\n\tif(type == 1 || type == 14){\r\n\t\t// if l3, nodeType != type\r\n\t\tname = isL3 ? attrs.name : nodeName;\r\n\t} else if(type == 2) {\r\n\t\t// no-op?\r\n\t\tkey = node.name;\r\n\t} else if (type == 5) {\r\n\t\t// no-op?\r\n\t} else if (type == 6) {\r\n\t\t// no-op?\r\n\t} else if(type == 3 || type == 8 || type == 12){\r\n\t\tvalue = isL3 ? node.textContent : node.data;\r\n\t}\r\n\t// return vnode\r\n\treturn new VNode(\r\n\t\tcx,\r\n\t\tnode,\r\n\t\ttype,\r\n\t\tname,\r\n\t\tkey,\r\n\t\tvalue,\r\n\t\tparent,\r\n\t\tdepth,\r\n\t\tindexInParent\r\n\t);\r\n}\r\n\r\n// TODO relative document?\r\nexport function create(type, nameOrValue) {\r\n\tif(type == 9) {\r\n\t\treturn document.implementation.createDocument(null,null);\r\n\t} else if(type == 10) {\r\n\t\treturn document.implementation.createDocumentType(...nameOrValue);\r\n\t} else if(type == 11) {\r\n\t\treturn document.createDocumentFragment();\r\n\t} else if(isBranch(type)){\r\n\t\tconst name = type == 1 ? nameOrValue : \"l3-\" + constructors[type];\r\n\t\tvar elem = document.createElement(name);\r\n\t\tif(type == 14) elem.name = nameOrValue;\r\n\t\treturn elem;\r\n\t} else if(type == 2) {\r\n\t\treturn document.createAttribute(nameOrValue);\r\n\t} else if(type == 3) {\r\n\t\treturn document.createTextNode(nameOrValue);\r\n\t} else if(type == 4) {\r\n\t\t// provisional link type ;)\r\n\t\tconst node = document.createElement(\"link\");\r\n\t\tnode.setAttribute(\"rel\",\"import\");\r\n\t\tnode.setAttribute(\"href\",nameOrValue);\r\n\t\treturn node;\r\n\t} else if(type == 7) {\r\n\t\treturn document.createProcessingInstruction(...nameOrValue);\r\n\t} else if(type == 8) {\r\n\t\treturn document.createComment(nameOrValue);\r\n\t}\r\n}\r\n\r\n\r\nexport function get(node,idx,type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)){\r\n\t\treturn filterWS(node.childNodes)[idx];\r\n\t}\r\n\treturn node[idx];\r\n}\r\n\r\nexport function has(node,idx,type){\r\n\treturn !!get(node,idx,type);\r\n}\r\n\r\nexport function next(node, vnode, type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)) {\r\n\t\t// ignore WS-only!\r\n\t\tvar nxt = vnode.nextSibling;\r\n\t\twhile(nxt && !ignoreWS(nxt)){\r\n\t\t\tnxt = vnode.nextSibling;\r\n\t\t}\r\n\t\treturn nxt || undefined;\r\n\t}\r\n}\r\n\r\nexport function previous(node, vnode, type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)) {\r\n\t\t// ignore WS-only!\r\n\t\tvar prv = vnode.previousSibling;\r\n\t\twhile(prv && !ignoreWS(prv)){\r\n\t\t\tprv = vnode.previousSibling;\r\n\t\t}\r\n\t\treturn prv || undefined;\r\n\t}\r\n}\r\n\r\nexport function push(node,kv,type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)){\r\n\t\tnode.appendChild(kv[1]);\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function set(node,key,val,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 1) {\r\n\t\tnode.setAttribute(key,val);\r\n\t} else if(type == 6) {\r\n\t\tconst attr = document.createElement(\"l3-a\");\r\n\t\tattr.setAttribute(\"name\", key);\r\n\t\tattr.appendChild(val);\r\n\t\tnode.appendChild(attr);\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function removeChild(node,vchild,type){\r\n\tif(isBranch(type)){\r\n\t\tnode.removeChild(vchild.node);\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function cached() {\r\n}\r\n\r\nexport function keys(node,type){\r\n\tif(type == 1 || type == 9 || type == 11 || type == 14 || type == 15) {\r\n\t\tlet children = filterWS(node.childNodes), len = children.length, keys = [];\r\n\t\tfor(let i = 0; i<len; i++){\r\n\t\t\tkeys[i] = getQName(children[i],i);\r\n\t\t}\r\n\t\treturn keys;\r\n\t}\r\n\t// TODO l3\r\n\tif(type == 5) return range(filterWS(node.childNodes).length).toArray();\r\n\tif(type == 6) return map(c => c.getAttribute(\"name\"))(filterWS(node.childNodes));\r\n\treturn [];\r\n}\r\n\r\nexport function values(node,type){\r\n\tif(type == 1 || type == 9 || type == 11) return filterWS(node.childNodes);\r\n\t//if (type == 2) return [[node.$name,node.$value]];\r\n\t//if(type == 6) return Object.values(node);\r\n\t//if (type == 8) return [node.$comment];\r\n\treturn node;\r\n}\r\n\r\nexport function finalize(node){\r\n\treturn node;\r\n}\r\n\r\nexport function count(node, type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)){\r\n\t\treturn filterWS(node.childNodes).length;\r\n\t}\r\n\t// TODO l3\r\n\treturn 0;\r\n}\r\n\r\nexport function first(node,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 1 || type == 9 || type == 11){\r\n\t\treturn filterWS(node.childNodes)[0];\r\n\t}\r\n}\r\n\r\nexport function last(node,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 1 || type == 9 || type == 11) return filterWS(node.childNodes).lastItem;\r\n}\r\n\r\nexport function entries(node, type){\r\n\ttype = type || getType(node);\r\n\tif(type == 1) {\r\n\t\tvar i = [];\r\n\t\ttry {\r\n\t\t\tfor(var a of node.attributes){\r\n\t\t\t\ti[a.name] = a.value;\r\n\t\t\t}\r\n\t\t} catch(err) {\r\n\t\t\t// whatever\r\n\t\t}\r\n\t\treturn i;\r\n\t}\r\n\treturn [];\r\n}\r\n\r\nexport function modify(node, vnode, ref, type){\r\n\ttype = type || getType(node);\r\n\tif (type == 2) {\r\n\t\t// insert faux data\r\n\t\tnode.$value = vnode.node;\r\n\t} else if (type == 6) {\r\n\t\tconst attr = document.createElement(\"l3-a\");\r\n\t\tattr.setAttribute(\"name\", vnode.key);\r\n\t\tattr.appendChild(vnode.node.$value);\r\n\t\tnode.appendChild(attr);\r\n\t} else if(isBranch(type)) {\r\n\t\tif (vnode.type == 2) {\r\n\t\t\t// TODO conversion rules!\r\n\t\t\tconst attr = vnode.node;\r\n\t\t\tattr.value = attr.$value.textContent;\r\n\t\t\tnode.setAttributeNode(attr);\r\n\t\t} else if (ref !== undefined) {\r\n\t\t\tnode.insertBefore(vnode.node,ref.node);\r\n\t\t} else {\r\n\t\t\tnode.appendChild(vnode.node);\r\n\t\t}\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function stringify(node,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 9 || type == 11) {\r\n\t\treturn map(c => stringify(c))(node.childNodes).join(\"\");\r\n\t} else if(isBranch(type)) {\r\n\t\treturn node.outerHTML;\r\n\t} else if(type == 10) {\r\n\t\treturn `<!DOCTYPE ${serialize(node.name,node.publicId,node.systemId)}>`;\r\n\t} else {\r\n\t\tconst text = node.textContent;\r\n\t\tif(type == 7) return `<?${text}?>`;\r\n\t\tif(type == 8) return `<!--${text}-->`;\r\n\t\tif(type == 12) return `<l3-x>${text}</l3-x>`;\r\n\t\treturn text;\r\n\t}\r\n}\r\n\r\nexport const getType = node => {\r\n\tvar nodeType = node.nodeType;\r\n\tvar nodeName = node.nodeName;\r\n\tlet isElem = nodeType == 1;\r\n\treturn isElem ? getL3Type(nodeName) || 1 : nodeType;\r\n};\r\n"],"file":"dom.js"}