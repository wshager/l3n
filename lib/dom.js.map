{"version":3,"sources":["../src/dom.js"],"names":["vnode","create","get","has","next","previous","push","set","removeChild","cached","keys","values","finalize","count","first","last","entries","modify","stringify","cx","wsre","ignoreWS","x","nodeType","test","textContent","filterWS","l3re","getL3Type","name","matches","exec","toLowerCase","i","l","length","constructors","getQName","node","indexInParent","nodeName","l3Type","isL3","attrs","attributes","__vnode_context","parent","depth","isElem","type","key","value","data","VNode","nameOrValue","document","implementation","createDocument","createDocumentType","createDocumentFragment","elem","createElement","createAttribute","createTextNode","setAttribute","createProcessingInstruction","createComment","idx","getType","childNodes","nxt","nextSibling","undefined","prv","previousSibling","kv","appendChild","val","attr","vchild","children","len","toArray","c","getAttribute","lastItem","a","err","ref","$value","setAttributeNode","insertBefore","join","outerHTML","publicId","systemId","text"],"mappings":"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","file":"dom.js","sourcesContent":["import { VNode } from \"./vnode\";\r\n\r\nimport { isBranch } from \"./convert\";\r\n\r\nimport { serialize } from \"./doctype\";\r\n\r\nimport { range, filter, map } from \"./array-util\";\r\n\r\n// import self!\r\nimport * as cx from \"./dom\";\r\n\r\n// helpers ---------------\r\nconst wsre = /^[\\t\\n\\r ]*$/;\r\nconst ignoreWS = x => x.nodeType != 3 || !wsre.test(x.textContent);\r\nconst filterWS = filter(ignoreWS);\r\n\r\nconst l3re = /^l3-(e?)(a?)(x?)(r?)(l?)(m?)(p?)(c?)()()(d?)()()(f?)(q?)$/;\r\nconst getL3Type = name => {\r\n\tconst matches = l3re.exec(name.toLowerCase());\r\n\tif(!matches) return 0;\r\n\tfor (let i = 1, l = matches.length; i < l; i++) {\r\n\t\tif (matches[i]) return i;\r\n\t}\r\n\treturn 0;\r\n};\r\n\r\nconst constructors = {\r\n\t1: \"e\",\r\n\t2: \"a\",\r\n\t3: \"x\",\r\n\t4: \"r\",\r\n\t5: \"l\",\r\n\t6: \"m\",\r\n\t7: \"p\",\r\n\t8: \"c\",\r\n\t12: \"x\",\r\n\t14: \"f\",\r\n\t15: \"q\"\r\n};\r\n\r\nvar getQName = function getQName(node, indexInParent) {\r\n\tvar nodeType = node.nodeType;\r\n\tvar nodeName = node.nodeName;\r\n\tif (nodeType == 1) {\r\n\t\tvar l3Type = getL3Type(nodeName);\r\n\t\t//let type = l3Type | nodeType;\r\n\t\tvar isL3 = l3Type !== 0;\r\n\t\tvar attrs = node.attributes;\r\n\t\treturn isL3 ? attrs.name : nodeName;\r\n\t} else {\r\n\t\treturn indexInParent + 1;\r\n\t}\r\n};\r\n\r\n//import { qname } from \"./qname\";\r\n\r\n// -----------------------\r\n// Core API\r\n// -----------------------\r\nexport const __vnode_context = \"dom\";\r\n\r\nexport function vnode(node, parent, depth, indexInParent) {\r\n\tvar nodeType = node.nodeType;\r\n\tvar nodeName = node.nodeName;\r\n\tlet isElem = nodeType == 1;\r\n\tvar l3Type = isElem ? getL3Type(nodeName) : 0;\r\n\tlet type = l3Type || nodeType;\r\n\tvar isL3 = isElem && l3Type !== 0;\r\n\tvar attrs = isElem ? node.attributes : null;\r\n\tvar name, key, value;\r\n\tif(type == 1 || type == 14){\r\n\t\t// if l3, nodeType != type\r\n\t\tname = isL3 ? attrs.name : nodeName;\r\n\t} else if(type == 2) {\r\n\t\t// no-op?\r\n\t\tkey = node.name;\r\n\t} else if (type == 5) {\r\n\t\t// no-op?\r\n\t} else if (type == 6) {\r\n\t\t// no-op?\r\n\t} else if(type == 3 || type == 8 || type == 12){\r\n\t\tvalue = isL3 ? node.textContent : node.data;\r\n\t}\r\n\t// return vnode\r\n\treturn new VNode(\r\n\t\tcx,\r\n\t\tnode,\r\n\t\ttype,\r\n\t\tname,\r\n\t\tkey,\r\n\t\tvalue,\r\n\t\tparent,\r\n\t\tdepth,\r\n\t\tindexInParent\r\n\t);\r\n}\r\n\r\n// TODO relative document?\r\nexport function create(type, nameOrValue) {\r\n\tif(type == 9) {\r\n\t\treturn document.implementation.createDocument(null,null);\r\n\t} else if(type == 10) {\r\n\t\treturn document.implementation.createDocumentType(...nameOrValue);\r\n\t} else if(type == 11) {\r\n\t\treturn document.createDocumentFragment();\r\n\t} else if(isBranch(type)){\r\n\t\tconst name = type == 1 ? nameOrValue : \"l3-\" + constructors[type];\r\n\t\tvar elem = document.createElement(name);\r\n\t\tif(type == 14) elem.name = nameOrValue;\r\n\t\treturn elem;\r\n\t} else if(type == 2) {\r\n\t\treturn document.createAttribute(nameOrValue);\r\n\t} else if(type == 3) {\r\n\t\treturn document.createTextNode(nameOrValue);\r\n\t} else if(type == 4) {\r\n\t\t// provisional link type ;)\r\n\t\tconst node = document.createElement(\"link\");\r\n\t\tnode.setAttribute(\"rel\",\"import\");\r\n\t\tnode.setAttribute(\"href\",nameOrValue);\r\n\t\treturn node;\r\n\t} else if(type == 7) {\r\n\t\treturn document.createProcessingInstruction(...nameOrValue);\r\n\t} else if(type == 8) {\r\n\t\treturn document.createComment(nameOrValue);\r\n\t}\r\n}\r\n\r\n\r\nexport function get(node,idx,type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)){\r\n\t\treturn filterWS(node.childNodes)[idx];\r\n\t}\r\n\treturn node[idx];\r\n}\r\n\r\nexport function has(node,idx,type){\r\n\treturn !!get(node,idx,type);\r\n}\r\n\r\nexport function next(node, vnode, type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)) {\r\n\t\t// ignore WS-only!\r\n\t\tvar nxt = vnode.nextSibling;\r\n\t\twhile(nxt && !ignoreWS(nxt)){\r\n\t\t\tnxt = vnode.nextSibling;\r\n\t\t}\r\n\t\treturn nxt || undefined;\r\n\t}\r\n}\r\n\r\nexport function previous(node, vnode, type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)) {\r\n\t\t// ignore WS-only!\r\n\t\tvar prv = vnode.previousSibling;\r\n\t\twhile(prv && !ignoreWS(prv)){\r\n\t\t\tprv = vnode.previousSibling;\r\n\t\t}\r\n\t\treturn prv || undefined;\r\n\t}\r\n}\r\n\r\nexport function push(node,kv,type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)){\r\n\t\tnode.appendChild(kv[1]);\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function set(node,key,val,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 1) {\r\n\t\tnode.setAttribute(key,val);\r\n\t} else if(type == 6) {\r\n\t\tconst attr = document.createElement(\"l3-a\");\r\n\t\tattr.setAttribute(\"name\", key);\r\n\t\tattr.appendChild(val);\r\n\t\tnode.appendChild(attr);\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function removeChild(node,vchild,type){\r\n\tif(isBranch(type)){\r\n\t\tnode.removeChild(vchild.node);\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function cached() {\r\n}\r\n\r\nexport function keys(node,type){\r\n\tif(type == 1 || type == 9 || type == 11 || type == 14 || type == 15) {\r\n\t\tlet children = filterWS(node.childNodes), len = children.length, keys = [];\r\n\t\tfor(let i = 0; i<len; i++){\r\n\t\t\tkeys[i] = getQName(children[i],i);\r\n\t\t}\r\n\t\treturn keys;\r\n\t}\r\n\t// TODO l3\r\n\tif(type == 5) return range(filterWS(node.childNodes).length).toArray();\r\n\tif(type == 6) return map(c => c.getAttribute(\"name\"))(filterWS(node.childNodes));\r\n\treturn [];\r\n}\r\n\r\nexport function values(node,type){\r\n\tif(type == 1 || type == 9 || type == 11) return filterWS(node.childNodes);\r\n\t//if (type == 2) return [[node.$name,node.$value]];\r\n\t//if(type == 6) return Object.values(node);\r\n\t//if (type == 8) return [node.$comment];\r\n\treturn node;\r\n}\r\n\r\nexport function finalize(node){\r\n\treturn node;\r\n}\r\n\r\nexport function count(node, type){\r\n\ttype = type || getType(node);\r\n\tif(isBranch(type)){\r\n\t\treturn filterWS(node.childNodes).length;\r\n\t}\r\n\t// TODO l3\r\n\treturn 0;\r\n}\r\n\r\nexport function first(node,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 1 || type == 9 || type == 11){\r\n\t\treturn filterWS(node.childNodes)[0];\r\n\t}\r\n}\r\n\r\nexport function last(node,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 1 || type == 9 || type == 11) return filterWS(node.childNodes).lastItem;\r\n}\r\n\r\nexport function entries(node, type){\r\n\ttype = type || getType(node);\r\n\tif(type == 1) {\r\n\t\tvar i = [];\r\n\t\ttry {\r\n\t\t\tfor(var a of node.attributes){\r\n\t\t\t\ti[a.name] = a.value;\r\n\t\t\t}\r\n\t\t} catch(err) {\r\n\t\t\t// whatever\r\n\t\t}\r\n\t\treturn i;\r\n\t}\r\n\treturn [];\r\n}\r\n\r\nexport function modify(node, vnode, ref, type){\r\n\ttype = type || getType(node);\r\n\tif (type == 2) {\r\n\t\t// insert faux data\r\n\t\tnode.$value = vnode.node;\r\n\t} else if (type == 6) {\r\n\t\tconst attr = document.createElement(\"l3-a\");\r\n\t\tattr.setAttribute(\"name\", vnode.key);\r\n\t\tattr.appendChild(vnode.node.$value);\r\n\t\tnode.appendChild(attr);\r\n\t} else if(isBranch(type)) {\r\n\t\tif (vnode.type == 2) {\r\n\t\t\t// TODO conversion rules!\r\n\t\t\tconst attr = vnode.node;\r\n\t\t\tattr.value = attr.$value.textContent;\r\n\t\t\tnode.setAttributeNode(attr);\r\n\t\t} else if (ref !== undefined) {\r\n\t\t\tnode.insertBefore(vnode.node,ref.node);\r\n\t\t} else {\r\n\t\t\tnode.appendChild(vnode.node);\r\n\t\t}\r\n\t}\r\n\treturn node;\r\n}\r\n\r\nexport function stringify(node,type){\r\n\ttype = type || getType(node);\r\n\tif(type == 9 || type == 11) {\r\n\t\treturn map(c => stringify(c))(node.childNodes).join(\"\");\r\n\t} else if(isBranch(type)) {\r\n\t\treturn node.outerHTML;\r\n\t} else if(type == 10) {\r\n\t\treturn `<!DOCTYPE ${serialize(node.name,node.publicId,node.systemId)}>`;\r\n\t} else {\r\n\t\tconst text = node.textContent;\r\n\t\tif(type == 7) return `<?${text}?>`;\r\n\t\tif(type == 8) return `<!--${text}-->`;\r\n\t\tif(type == 12) return `<l3-x>${text}</l3-x>`;\r\n\t\treturn text;\r\n\t}\r\n}\r\n\r\nexport const getType = node => {\r\n\tvar nodeType = node.nodeType;\r\n\tvar nodeName = node.nodeName;\r\n\tlet isElem = nodeType == 1;\r\n\treturn isElem ? getL3Type(nodeName) || 1 : nodeType;\r\n};\r\n"]}